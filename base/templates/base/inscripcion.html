<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Inscripción de Jugadoras - CFF Olympia</title>
    <style>
        :root {
            --primary-blue: #2a374c;
            --secondary-blue: #1f2531;
            --primary-gold: #b8ac84;
            --secondary-gold: #7f765a;
            --blanco: #ffffff;
            --gris-claro: #f5f5f5;
            --sombra: 0 10px 20px rgba(0, 0, 0, 0.2);
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            max-width: 900px;
            margin: 0 auto;
            padding: 20px;
            background-color: var(--primary-blue);
            color: var(--blanco);
        }

        h1 {
            text-align: center;
            color: var(--primary-gold);
            margin-bottom: 30px;
            font-size: 2.5rem;
            animation: fadeIn 0.8s ease-out;
        }

        h2 {
            color: var(--primary-gold);
            margin-bottom: 20px;
        }

        h3 {
            color: var(--primary-gold);
            margin-bottom: 15px;
            border-bottom: 1px solid var(--primary-gold);
            padding-bottom: 5px;
        }

        /* Estilos para el menú de pasos */
        .steps-menu {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin: 40px auto;
            padding-top: 40px;
            animation: fadeIn 0.6s ease-out;
            justify-content: center;
        }

        .step-card {
            border: 2px solid var(--primary-gold);
            border-radius: 10px;
            padding: 20px 10px;
            text-align: center;
            cursor: pointer;
            transition: all 0.4s;
            background-color: var(--secondary-blue);
            color: var(--blanco);
            box-shadow: var(--sombra);
        }

        .step-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 30px rgba(0, 0, 0, 0.3);
        }

        .step-card.completed {
            background-color: rgba(184, 172, 132, 0.1);
            border-color: var(--secondary-gold);
        }

        .step-card.active {
            background-color: var(--primary-gold);
            color: var(--secondary-blue);
            font-weight: bold;
        }

        .step-card.locked {
            opacity: 0.6;
            cursor: not-allowed;
            border-color: #555;
        }

        /* Estilos para el formulario de pasos */
        .form-container {
            display: none;
            background-color: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            margin-top: 50px;
            padding: 30px;
            box-shadow: var(--sombra);
            border: 1px solid rgba(184, 172, 132, 0.2);
            animation: fadeIn 0.5s ease-out;
        }

        .form-container.active {
            display: block;
        }

        .form-group {
            margin-bottom: 25px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: var(--primary-gold);
        }

        input,
        select,
        textarea {
            width: 100%;
            padding: 12px 15px;
            border: 1px solid rgba(184, 172, 132, 0.3);
            border-radius: 8px;
            font-size: 16px;
            background-color: var(--secondary-blue);
            color: var(--blanco);
            transition: all 0.3s;
        }

        input:focus,
        select:focus,
        textarea:focus {
            outline: none;
            border-color: var(--primary-gold);
            box-shadow: 0 0 0 2px rgba(184, 172, 132, 0.3);
        }

        .navigation-buttons {
            margin-top: 40px;
            display: flex;
            justify-content: space-between;
        }

        button {
            background: var(--primary-gold);
            color: var(--secondary-blue);
            border: none;
            padding: 12px 25px;
            cursor: pointer;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            transition: all 0.3s;
        }

        button:hover {
            transform: translateY(-2px);
            background: var(--secondary-gold);
        }

        button.secondary {
            background: transparent;
            color: var(--primary-gold);
            border: 1px solid var(--primary-gold);
        }

        button.secondary:hover {
            background: rgba(184, 172, 132, 0.1);
        }

        button:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }

        .error-message {
            color: #ff6b6b;
            margin-top: 8px;
            font-size: 0.9rem;
        }

        .alert {
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            animation: fadeIn 0.5s ease-out;
        }

        .alert-success {
            background-color: rgba(46, 125, 50, 0.2);
            border: 1px solid #2e7d32;
            color: #a5d6a7;
        }

        .alert-error {
            background-color: rgba(198, 40, 40, 0.2);
            border: 1px solid #c62828;
            color: #ffabab;
        }

        .alert-info {
            background-color: rgba(30, 136, 229, 0.2);
            border: 1px solid #1e88e5;
            color: #90caf9;
        }

        .welcome-screen {
            text-align: center;
            padding: 40px;
            background-color: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            margin-top: 50px;
            animation: fadeIn 1s ease-out;
        }

        .welcome-screen button {
            margin: 20px 10px;
        }

        .summary-container {
            background-color: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 20px;
            border-left: 4px solid var(--primary-gold);
        }

        .summary-item {
            margin-bottom: 15px;
            display: flex;
        }

        .summary-label {
            font-weight: 600;
            color: var(--primary-gold);
            min-width: 200px;
        }

        .summary-value {
            flex: 1;
        }

        .payment-info {
            background-color: rgba(184, 172, 132, 0.1);
            border-radius: 10px;
            padding: 20px;
            margin: 30px 0;
            border: 1px solid var(--primary-gold);
        }

        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255, 255, 255, .3);
            border-radius: 50%;
            border-top-color: var(--blanco);
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to {
                transform: rotate(360deg);
            }
        }

        /* Responsive */
        @media (max-width: 768px) {
            .steps-menu {
                grid-template-columns: 1fr 1fr;
            }

            .form-container {
                padding: 20px;
            }

            h1 {
                font-size: 2rem;
            }

            .summary-item {
                flex-direction: column;
            }

            .summary-label {
                min-width: auto;
                margin-bottom: 5px;
            }
        }

        @media (max-width: 480px) {
            .steps-menu {
                grid-template-columns: 1fr;
            }

            .navigation-buttons {
                flex-direction: column;
                gap: 10px;
            }

            button {
                width: 100%;
            }

            .welcome-screen button {
                width: auto;
            }
        }
    </style>
    <!-- SheetJS para generar Excel -->
    <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
</head>

<body>
    <h1>Formulario de Inscripción - CFF Olympia</h1>

    <!-- Pantalla de bienvenida -->
    <div class="welcome-screen" id="welcomeScreen">
        <h2>Bienvenida al proceso de inscripción</h2>
        <p>Para formalizar tu inscripción al CFF Olympia, completa todos los pasos del formulario y realiza el pago
            correspondiente.</p>
        <p><strong>Importante:</strong> Tu inscripción solo será válida una vez completado el formulario y realizado el
            pago.</p>
        <button onclick="startRegistration()">Comenzar inscripción</button>
    </div>

    <!-- Menú de pasos -->
    <div class="steps-menu" id="stepsMenu" style="display: none;">
        <div class="step-card active" data-step="1" onclick="navigateToStep(1)">
            <div>Información Personal</div>
        </div>
        <div class="step-card locked" data-step="2" onclick="navigateToStep(2)">
            <div>Posición y Equipo</div>
        </div>
        <div class="step-card locked" data-step="3" onclick="navigateToStep(3)">
            <div>Información Médica</div>
        </div>
        <div class="step-card locked" data-step="4" onclick="navigateToStep(4)">
            <div>Equipación</div>
        </div>
        <div class="step-card locked" data-step="5" onclick="navigateToStep(5)">
            <div>Confirmación</div>
        </div>
    </div>

    <!-- Contenedor del formulario actual -->
    <div id="currentFormContainer" style="display: none;">
        <!-- Paso 1: Información Personal -->
        <div class="form-container active" id="step1Form">
            <h2>Información Personal</h2>

            <div class="form-group">
                <label for="nombre">Nombre*</label>
                <input type="text" id="nombre" name="nombre" placeholder="Escribe tu nombre" required>
                <div class="error-message" id="nombre_error"></div>
            </div>

            <div class="form-group">
                <label for="apellido">Apellido*</label>
                <input type="text" id="apellido" name="apellido" placeholder="Escribe tu apellido" required>
                <div class="error-message" id="apellido_error"></div>
            </div>

            <div class="form-group">
                <label for="dni">DNI/NIE*</label>
                <input type="text" id="dni" name="dni" placeholder="Escribe tu DNI o NIE" required>
                <div class="error-message" id="dni_error"></div>
            </div>

            <div class="form-group">
                <label for="fecha_nacimiento">Fecha de Nacimiento*</label>
                <input type="date" id="fecha_nacimiento" name="fecha_nacimiento" required>
                <div class="error-message" id="fecha_nacimiento_error"></div>
            </div>

            <div class="form-group">
                <label for="email">Email*</label>
                <input type="email" id="email" name="email" placeholder="Escribe tu email" required>
                <div class="error-message" id="email_error"></div>
            </div>

            <div class="form-group">
                <label for="telefono">Teléfono*</label>
                <input type="tel" id="telefono" name="telefono" placeholder="Escribe tu teléfono" required>
                <div class="error-message" id="telefono_error"></div>
            </div>

            <div class="navigation-buttons">
                <button type="button" class="secondary" onclick="backToStepsMenu()">Volver al menú</button>
                <button type="button" id="step1Button" onclick="saveStep(1)">Continuar</button>
            </div>
        </div>

        <!-- Paso 2: Posición y Equipo -->
        <div class="form-container" id="step2Form">
            <h2>Posición y Equipo</h2>

            <div class="form-group">
                <label for="posicion">Posición en el campo*</label>
                <select id="posicion" name="posicion" required>
                    <option value="">Selecciona tu posición</option>
                    <option value="Portero">Portero</option>
                    <option value="Defensa">Defensa</option>
                    <option value="Centrocampista">Centrocampista</option>
                    <option value="Delantero">Delantero</option>
                </select>
                <div class="error-message" id="posicion_error"></div>
            </div>

            <div class="form-group">
                <label for="equipo">Equipo*</label>
                <select id="equipo" name="equipo" required>
                    <option value="">Selecciona tu equipo</option>
                    <option value="Senior A">Senior A</option>
                    <option value="Senior B">Senior B</option>
                    <option value="Sub-21">Sub-21</option>
                    <option value="Juvenil">Juvenil</option>
                    <option value="Cadete">Cadete</option>
                </select>
                <div class="error-message" id="equipo_error"></div>
            </div>

            <div class="navigation-buttons">
                <button type="button" class="secondary" onclick="navigateToStep(1)">Anterior</button>
                <button type="button" id="step2Button" onclick="saveStep(2)">Guardar y continuar</button>
            </div>
        </div>

        <!-- Paso 3: Información Médica -->
        <div class="form-container" id="step3Form">
            <h2>Información Médica</h2>

            <div class="form-group">
                <label for="tipo_sangre">Tipo de Sangre</label>
                <select id="tipo_sangre" name="tipo_sangre">
                    <option value="">Selecciona tu tipo de sangre</option>
                    <option value="A+">A+</option>
                    <option value="A-">A-</option>
                    <option value="B+">B+</option>
                    <option value="B-">B-</option>
                    <option value="AB+">AB+</option>
                    <option value="AB-">AB-</option>
                    <option value="O+">O+</option>
                    <option value="O-">O-</option>
                </select>
            </div>

            <div class="form-group">
                <label for="alergias">Alergias</label>
                <textarea id="alergias" name="alergias" placeholder="Describe cualquier alergia que tengas"></textarea>
            </div>

            <div class="form-group">
                <label for="contacto_emergencia_nombre">Nombre de Contacto de Emergencia*</label>
                <input type="text" id="contacto_emergencia_nombre" name="contacto_emergencia_nombre"
                    placeholder="Nombre completo" required>
                <div class="error-message" id="contacto_emergencia_nombre_error"></div>
            </div>

            <div class="form-group">
                <label for="contacto_emergencia_telefono">Teléfono de Contacto de Emergencia*</label>
                <input type="tel" id="contacto_emergencia_telefono" name="contacto_emergencia_telefono"
                    placeholder="Número de teléfono" required>
                <div class="error-message" id="contacto_emergencia_telefono_error"></div>
            </div>

            <div class="form-group">
                <label for="contacto_emergencia_parentesco">Parentesco con Contacto de Emergencia*</label>
                <input type="text" id="contacto_emergencia_parentesco" name="contacto_emergencia_parentesco"
                    placeholder="Ej: Madre, Padre, etc." required>
                <div class="error-message" id="contacto_emergencia_parentesco_error"></div>
            </div>

            <div class="navigation-buttons">
                <button type="button" class="secondary" onclick="navigateToStep(2)">Anterior</button>
                <button type="button" id="step3Button" onclick="saveStep(3)">Guardar y continuar</button>
            </div>
        </div>

        <!-- Paso 4: Equipación -->
        <div class="form-container" id="step4Form">
            <h2>Equipación</h2>

            <div class="form-group">
                <label for="talla_equipacion">Talla de Equipación*</label>
                <select id="talla_equipacion" name="talla_equipacion" required>
                    <option value="">Selecciona tu talla</option>
                    <option value="XS">XS</option>
                    <option value="S">S</option>
                    <option value="M">M</option>
                    <option value="L">L</option>
                    <option value="XL">XL</option>
                    <option value="XXL">XXL</option>
                </select>
                <div class="error-message" id="talla_equipacion_error"></div>
            </div>

            <div class="form-group">
                <label for="talla_pantalon">Talla de Pantalón</label>
                <select id="talla_pantalon" name="talla_pantalon">
                    <option value="">Selecciona tu talla</option>
                    <option value="XS">XS</option>
                    <option value="S">S</option>
                    <option value="M">M</option>
                    <option value="L">L</option>
                    <option value="XL">XL</option>
                    <option value="XXL">XXL</option>
                </select>
            </div>

            <div class="form-group">
                <label for="numero_camiseta">Número preferido en camiseta</label>
                <input type="number" id="numero_camiseta" name="numero_camiseta" placeholder="Ej: 10" min="1" max="99">
            </div>

            <div class="navigation-buttons">
                <button type="button" class="secondary" onclick="navigateToStep(3)">Anterior</button>
                <button type="button" id="step4Button" onclick="saveStep(4)">Guardar y continuar</button>
            </div>
        </div>

        <!-- Paso 5: Confirmación y Pago -->
        <div class="form-container" id="step5Form">
            <h2>Resumen y Confirmación</h2>

            <div id="resumenInscripcion">
                <!-- Aquí se mostrará el resumen de los datos -->
            </div>

            <div class="payment-info">
                <h3>Instrucciones de Pago</h3>
                <p>Para completar tu inscripción, realiza el pago de la cuota mediante transferencia bancaria:</p>
                <p><strong>Banco:</strong> [Nombre de tu banco]</p>
                <p><strong>Titular:</strong> [Nombre del titular de la cuenta]</p>
                <p><strong>IBAN:</strong> [Tu número de cuenta IBAN]</p>
                <p><strong>Concepto:</strong> Inscripción [Nombre] [Apellido] - [Equipo]</p>
                <p><strong>Importe:</strong> [Cantidad]€</p>
                <p>Una vez realizado el pago, haz clic en el botón "Completar Inscripción" para finalizar el proceso.
                </p>
            </div>

            <div class="form-group">
                <label for="comprobante_pago">¿Ya has realizado el pago?*</label>
                <select id="comprobante_pago" name="comprobante_pago" required>
                    <option value="">Selecciona una opción</option>
                    <option value="si">Sí, he realizado el pago</option>
                    <option value="no">No, lo haré más tarde</option>
                </select>
                <div class="error-message" id="comprobante_pago_error"></div>
            </div>

            <div class="navigation-buttons">
                <button type="button" class="secondary" onclick="navigateToStep(4)">Anterior</button>
                <button type="button" id="step5Button" onclick="completeRegistration()">Completar Inscripción</button>
            </div>
        </div>
    </div>

    <!-- Contenedor para mensajes -->
    <div id="messageContainer" style="margin-top: 20px;"></div>

    <script>
        // Objeto para almacenar los datos del formulario
        const formData = {
            step1: { completed: false, data: {} },
            step2: { completed: false, data: {} },
            step3: { completed: false, data: {} },
            step4: { completed: false, data: {} },
            step5: { completed: false, data: {} }
        };

        // Mostrar la pantalla de bienvenida al cargar la página
        document.addEventListener('DOMContentLoaded', function () {
            showWelcomeScreen();
        });

        // Función para mostrar la pantalla de bienvenida
        function showWelcomeScreen() {
            document.getElementById('welcomeScreen').style.display = 'block';
            document.getElementById('stepsMenu').style.display = 'none';
            document.getElementById('currentFormContainer').style.display = 'none';
        }

        // Función para comenzar la inscripción
        function startRegistration() {
            document.getElementById('welcomeScreen').style.display = 'none';
            document.getElementById('stepsMenu').style.display = 'grid';
            document.getElementById('currentFormContainer').style.display = 'none';

            // Resetear datos del formulario
            for (let key in formData) {
                formData[key].completed = false;
                formData[key].data = {};
            }

            // Limpiar campos del formulario
            document.querySelectorAll('input, select, textarea').forEach(field => {
                field.value = '';
            });

            updateStepCards();
        }

        // Función para volver al menú de pasos
        function backToStepsMenu() {
            document.getElementById('stepsMenu').style.display = 'grid';
            document.getElementById('currentFormContainer').style.display = 'none';
        }

        // Función para navegar a un paso específico
        function navigateToStep(stepNumber) {
            const stepCard = document.querySelector(`.step-card[data-step="${stepNumber}"]`);

            // Si el paso está bloqueado y no está completado, no permitir navegar
            if (stepNumber > 1 && !formData[`step${stepNumber - 1}`].completed &&
                stepCard.classList.contains('locked')) {
                showMessage('Debes completar el paso anterior primero', 'error');
                return;
            }

            // Si es el paso 5, generar el resumen
            if (stepNumber === 5) {
                generateSummary();
            }

            // Ocultar menú de pasos
            document.getElementById('stepsMenu').style.display = 'none';
            document.getElementById('currentFormContainer').style.display = 'block';

            // Ocultar todos los formularios
            document.querySelectorAll('.form-container').forEach(el => {
                el.classList.remove('active');
            });

            // Mostrar el formulario correspondiente
            document.getElementById(`step${stepNumber}Form`).classList.add('active');
        }

        // Función para generar el resumen de la inscripción
        function generateSummary() {
            const resumenContainer = document.getElementById('resumenInscripcion');
            let html = `
                <h3>Resumen de tu inscripción</h3>
                <div class="summary-container">
                    <h4>Información Personal</h4>
                    <div class="summary-item">
                        <span class="summary-label">Nombre:</span>
                        <span class="summary-value">${formData.step1.data.nombre || ''} ${formData.step1.data.apellido || ''}</span>
                    </div>
                    <div class="summary-item">
                        <span class="summary-label">DNI/NIE:</span>
                        <span class="summary-value">${formData.step1.data.dni || ''}</span>
                    </div>
                    <div class="summary-item">
                        <span class="summary-label">Fecha de Nacimiento:</span>
                        <span class="summary-value">${formData.step1.data.fecha_nacimiento || ''}</span>
                    </div>
                    <div class="summary-item">
                        <span class="summary-label">Email:</span>
                        <span class="summary-value">${formData.step1.data.email || ''}</span>
                    </div>
                    <div class="summary-item">
                        <span class="summary-label">Teléfono:</span>
                        <span class="summary-value">${formData.step1.data.telefono || ''}</span>
                    </div>
                </div>

                <div class="summary-container">
                    <h4>Información Deportiva</h4>
                    <div class="summary-item">
                        <span class="summary-label">Posición:</span>
                        <span class="summary-value">${formData.step2.data.posicion || ''}</span>
                    </div>
                    <div class="summary-item">
                        <span class="summary-label">Equipo:</span>
                        <span class="summary-value">${formData.step2.data.equipo || ''}</span>
                    </div>
                </div>

                <div class="summary-container">
                    <h4>Información Médica</h4>
                    <div class="summary-item">
                        <span class="summary-label">Tipo de Sangre:</span>
                        <span class="summary-value">${formData.step3.data.tipo_sangre || 'No especificado'}</span>
                    </div>
                    <div class="summary-item">
                        <span class="summary-label">Alergias:</span>
                        <span class="summary-value">${formData.step3.data.alergias || 'Ninguna'}</span>
                    </div>
                    <div class="summary-item">
                        <span class="summary-label">Contacto de Emergencia:</span>
                        <span class="summary-value">${formData.step3.data.contacto_emergencia_nombre || ''} (${formData.step3.data.contacto_emergencia_parentesco || ''}) - ${formData.step3.data.contacto_emergencia_telefono || ''}</span>
                    </div>
                </div>

                <div class="summary-container">
                    <h4>Equipación</h4>
                    <div class="summary-item">
                        <span class="summary-label">Talla Equipación:</span>
                        <span class="summary-value">${formData.step4.data.talla_equipacion || ''}</span>
                    </div>
                    <div class="summary-item">
                        <span class="summary-label">Talla Pantalón:</span>
                        <span class="summary-value">${formData.step4.data.talla_pantalon || 'No especificado'}</span>
                    </div>
                    <div class="summary-item">
                        <span class="summary-label">Número Camiseta:</span>
                        <span class="summary-value">${formData.step4.data.numero_camiseta || 'No especificado'}</span>
                    </div>
                </div>
            `;

            resumenContainer.innerHTML = html;
        }

        // Función para guardar un paso completo
        function saveStep(stepNumber) {
            // Validar campos requeridos
            let isValid = true;
            const formContainer = document.getElementById(`step${stepNumber}Form`);
            const requiredInputs = formContainer.querySelectorAll('[required]');
            const stepButton = document.getElementById(`step${stepNumber}Button`);

            requiredInputs.forEach(input => {
                if (!input.value.trim()) {
                    isValid = false;
                    const errorElement = document.getElementById(`${input.name}_error`);
                    if (errorElement) errorElement.textContent = 'Este campo es obligatorio';
                    input.style.borderColor = '#ff6b6b';
                } else {
                    const errorElement = document.getElementById(`${input.name}_error`);
                    if (errorElement) errorElement.textContent = '';
                    input.style.borderColor = '';
                }
            });

            if (!isValid) {
                showMessage('Por favor completa todos los campos requeridos', 'error');
                // Scroll to first error
                const firstError = formContainer.querySelector('[required]:invalid');
                if (firstError) firstError.scrollIntoView({ behavior: 'smooth', block: 'center' });
                return;
            }

            // Guardar datos del paso
            const inputs = formContainer.querySelectorAll('input, select, textarea');
            inputs.forEach(input => {
                formData[`step${stepNumber}`].data[input.name] = input.value;
            });

            // Marcar el paso como completado
            formData[`step${stepNumber}`].completed = true;

            if (stepNumber < 5) {
                // Navegar al menú de pasos
                updateStepCards();
                backToStepsMenu();
                showMessage('Paso ' + stepNumber + ' completado correctamente', 'success');
            }
        }

        // Función para completar la inscripción
        function completeRegistration() {
            const comprobantePago = document.getElementById('comprobante_pago');
            const stepButton = document.getElementById('step5Button');

            if (!comprobantePago.value) {
                showMessage('Por favor indica si has realizado el pago', 'error');
                return;
            }

            // Mostrar indicador de carga
            stepButton.innerHTML = '<span class="loading"></span> Procesando...';
            stepButton.disabled = true;

            try {
                // Recopilar todos los datos
                const allData = {
                    ...formData.step1.data,
                    ...formData.step2.data,
                    ...formData.step3.data,
                    ...formData.step4.data,
                    fecha_inscripcion: new Date().toLocaleDateString('es-ES'),
                    comprobante_pago: comprobantePago.value
                };

                // Generar Excel
                generateExcel(allData);

                // Enviar por email usando FormSubmit
                sendEmail(allData);

                showMessage('¡Inscripción completada con éxito! Se ha enviado un email de confirmación y se ha generado un archivo Excel con tus datos.', 'success');

                // Resetear formulario después de éxito
                setTimeout(() => {
                    document.querySelectorAll('input, select, textarea').forEach(input => {
                        input.value = '';
                    });
                    for (let key in formData) {
                        formData[key].completed = false;
                        formData[key].data = {};
                    }
                    showWelcomeScreen();
                }, 5000);

            } catch (error) {
                console.error('Error:', error);
                showMessage('Error al completar la inscripción: ' + error.message, 'error');
            } finally {
                // Restaurar botón
                stepButton.innerHTML = 'Completar Inscripción';
                stepButton.disabled = false;
            }
        }

        // Función para generar archivo Excel
        function generateExcel(data) {
            // Crear datos para Excel
            const excelData = [
                ['CAMPO', 'VALOR'],
                ['Nombre', data.nombre],
                ['Apellido', data.apellido],
                ['DNI/NIE', data.dni],
                ['Fecha de Nacimiento', data.fecha_nacimiento],
                ['Email', data.email],
                ['Teléfono', data.telefono],
                ['Posición', data.posicion],
                ['Equipo', data.equipo],
                ['Tipo de Sangre', data.tipo_sangre || 'No especificado'],
                ['Alergias', data.alergias || 'Ninguna'],
                ['Contacto Emergencia Nombre', data.contacto_emergencia_nombre],
                ['Contacto Emergencia Teléfono', data.contacto_emergencia_telefono],
                ['Contacto Emergencia Parentesco', data.contacto_emergencia_parentesco],
                ['Talla Equipación', data.talla_equipacion],
                ['Talla Pantalón', data.talla_pantalon || 'No especificado'],
                ['Número Camiseta', data.numero_camiseta || 'No especificado'],
                ['Fecha de Inscripción', data.fecha_inscripcion],
                ['Comprobante de Pago', data.comprobante_pago === 'si' ? 'Sí' : 'No']
            ];

            // Crear libro de trabajo
            const wb = XLSX.utils.book_new();
            const ws = XLSX.utils.aoa_to_sheet(excelData);

            // Añadir hoja al libro
            XLSX.utils.book_append_sheet(wb, ws, "Inscripción");

            // Generar nombre de archivo
            const fileName = `Inscripción_${data.nombre}_${data.apellido}_${new Date().getTime()}.xlsx`;

            // Descargar archivo
            XLSX.writeFile(wb, fileName);
        }

        // Función para enviar email usando FormSubmit
        function sendEmail(data) {
            // Crear formulario oculto
            const form = document.createElement('form');
            form.style.display = 'none';
            form.method = 'POST';
            form.action = 'https://formsubmit.co/moezehero@gmail.com'; // REEMPLAZA CON TU EMAIL
            form.enctype = 'multipart/form-data';

            // Añadir campo para redirección
            const redirectInput = document.createElement('input');
            redirectInput.type = 'hidden';
            redirectInput.name = '_next';
            redirectInput.value = window.location.href + '?success=true';
            form.appendChild(redirectInput);

            // Añadir campo para asunto
            const subjectInput = document.createElement('input');
            subjectInput.type = 'hidden';
            subjectInput.name = '_subject';
            subjectInput.value = `Nueva inscripción - ${data.nombre} ${data.apellido}`;
            form.appendChild(subjectInput);

            // Añadir campo para template
            const templateInput = document.createElement('input');
            templateInput.type = 'hidden';
            templateInput.name = '_template';
            templateInput.value = 'table';
            form.appendChild(templateInput);

            // Añadir todos los datos como campos ocultos
            for (const key in data) {
                if (data.hasOwnProperty(key)) {
                    const input = document.createElement('input');
                    input.type = 'hidden';
                    input.name = key;
                    input.value = data[key];
                    form.appendChild(input);
                }
            }

            // Añadir formulario al documento y enviar
            document.body.appendChild(form);
            form.submit();
            document.body.removeChild(form);
        }

        // Función para actualizar las tarjetas de pasos
        function updateStepCards() {
            const stepCards = document.querySelectorAll('.step-card');

            stepCards.forEach(card => {
                const stepNumber = parseInt(card.dataset.step);

                // Resetear clases
                card.classList.remove('active', 'completed', 'locked');

                // Marcar pasos completados
                if (formData[`step${stepNumber}`].completed) {
                    card.classList.add('completed');
                }

                // Desbloquear pasos si el anterior está completado
                if (stepNumber === 1 || formData[`step${stepNumber - 1}`].completed) {
                    card.classList.remove('locked');
                } else {
                    card.classList.add('locked');
                }
            });
        }

        // Función para mostrar mensajes
        function showMessage(message, type) {
            const container = document.getElementById('messageContainer');
            const alertClass = type === 'error' ? 'alert-error' :
                type === 'success' ? 'alert-success' : 'alert-info';
            container.innerHTML = `<div class="alert ${alertClass}">${message}</div>`;
            setTimeout(() => { container.innerHTML = ''; }, 5000);
        }
    </script>
</body>

</html>
