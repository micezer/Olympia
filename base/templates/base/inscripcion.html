{% extends 'main.html' %}
{% load static %}

{% block content %}

{% csrf_token %}

<meta name="viewport" content="width=device-width, initial-scale=1.0, 
      maximum-scale=1.0, minimum-scale=1.0,
      user-scalable=no, shrink-to-fit=no">

<style>
    :root {
        --primary-blue: #2a374c;
        --secondary-blue: #1f2531;
        --primary-gold: #b8ac84;
        --secondary-gold: #7f765a;
        --blanco: #ffffff;
        --gris-claro: #f5f5f5;
        --sombra: 0 10px 20px rgba(0, 0, 0, 0.2);
    }

    @keyframes fadeIn {
        from {
            opacity: 0;
            transform: translateY(20px);
        }

        to {
            opacity: 1;
            transform: translateY(0);
        }
    }

    body {
        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        line-height: 1.6;
        max-width: 900px;
        margin: 0 auto;
        padding: 20px;
        background-color: var(--primary-blue);
        color: var(--blanco);
    }

    h1 {
        text-align: center;
        color: var(--primary-gold);
        margin-bottom: 30px;
        font-size: 2.5rem;
        animation: fadeIn 0.8s ease-out;
    }

    h2 {
        color: var(--primary-gold);
        margin-bottom: 20px;
    }

    /* Estilos para el menú de pasos */
    .steps-menu {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
        gap: 10px;
        margin: 40px auto;
        padding-top: 40px;
        animation: fadeIn 0.6s ease-out;
        justify-content: center;
    }

    .step-card {
        border: 2px solid var(--primary-gold);
        border-radius: 10px;
        padding: 15px 8px;
        text-align: center;
        cursor: pointer;
        transition: all 0.4s;
        background-color: var(--secondary-blue);
        color: var(--blanco);
        box-shadow: var(--sombra);
        font-size: 0.9rem;
    }

    .step-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 15px 30px rgba(0, 0, 0, 0.3);
    }

    .step-card.completed {
        background-color: rgba(184, 172, 132, 0.1);
        border-color: var(--secondary-gold);
    }

    .step-card.active {
        background-color: var(--primary-gold);
        color: var(--secondary-blue);
        font-weight: bold;
    }

    .step-card.locked {
        opacity: 0.6;
        cursor: not-allowed;
        border-color: #555;
    }

    /* Estilos para el formulario de pasos */
    .form-container {
        display: none;
        background-color: rgba(255, 255, 255, 0.05);
        border-radius: 15px;
        margin-top: 30px;
        padding: 30px;
        box-shadow: var(--sombra);
        border: 1px solid rgba(184, 172, 132, 0.2);
        animation: fadeIn 0.5s ease-out;
    }

    .form-container.active {
        display: block;
    }

    .form-group {
        margin-bottom: 25px;
    }

    label {
        display: block;
        margin-bottom: 8px;
        font-weight: 500;
        color: var(--primary-gold);
    }

    input,
    select,
    textarea {
        width: 100%;
        padding: 12px 15px;
        border: 1px solid rgba(184, 172, 132, 0.3);
        border-radius: 8px;
        font-size: 16px;
        background-color: var(--secondary-blue);
        color: var(--blanco);
        transition: all 0.3s;
    }

    input:focus,
    select:focus,
    textarea:focus {
        outline: none;
        border-color: var(--primary-gold);
        box-shadow: 0 0 0 2px rgba(184, 172, 132, 0.3);
    }

    .navigation-buttons {
        margin-top: 40px;
        display: flex;
        justify-content: space-between;
    }

    button {
        background: var(--primary-gold);
        color: var(--secondary-blue);
        border: none;
        padding: 12px 25px;
        cursor: pointer;
        border-radius: 8px;
        font-size: 16px;
        font-weight: 600;
        transition: all 0.3s;
    }

    button:hover {
        transform: translateY(-2px);
        background: var(--secondary-gold);
    }

    button.secondary {
        background: transparent;
        color: var(--primary-gold);
        border: 1px solid var(--primary-gold);
    }

    button.secondary:hover {
        background: rgba(184, 172, 132, 0.1);
    }

    button:disabled {
        opacity: 0.6;
        cursor: not-allowed;
    }

    .error-message {
        color: #ff6b6b;
        margin-top: 8px;
        font-size: 0.9rem;
    }

    .alert {
        padding: 15px;
        border-radius: 8px;
        margin-bottom: 20px;
        animation: fadeIn 0.5s ease-out;
    }

    .alert-success {
        background-color: rgba(46, 125, 50, 0.2);
        border: 1px solid #2e7d32;
        color: #a5d6a7;
    }

    .alert-error {
        background-color: rgba(198, 40, 40, 0.2);
        border: 1px solid #c62828;
        color: #ffabab;
    }

    .alert-info {
        background-color: rgba(30, 136, 229, 0.2);
        border: 1px solid #1e88e5;
        color: #90caf9;
    }

    .welcome-screen {
                display: block; /* Visible por defecto */
        text-align: center;
        padding: 40px;
        background-color: rgba(255, 255, 255, 0.05);
        border-radius: 15px;
        margin-top: 50px;
        animation: fadeIn 1s ease-out;
    }

    .welcome-screen button {
        margin: 20px 10px;
    }

    .summary-container {
        background-color: rgba(255, 255, 255, 0.05);
        border-radius: 15px;
        padding: 25px;
        margin-bottom: 20px;
        border-left: 4px solid var(--primary-gold);
    }

    .summary-item {
        margin-bottom: 15px;
        display: flex;
    }

    .summary-label {
        font-weight: 600;
        color: var(--primary-gold);
        min-width: 200px;
        margin-right: 15px;
    }

    .summary-value {
        flex: 1;
    }

    .payment-info {
        background-color: rgba(184, 172, 132, 0.1);
        border-radius: 10px;
        padding: 20px;
        margin: 30px 0;
        border: 1px solid var(--primary-gold);
    }

    .loading {
        display: inline-block;
        width: 20px;
        height: 20px;
        border: 3px solid rgba(255, 255, 255, .3);
        border-radius: 50%;
        border-top-color: var(--blanco);
        animation: spin 1s ease-in-out infinite;
    }

    @keyframes spin {
        to {
            transform: rotate(360deg);
        }
    }

    .payment-message {
        display: none;
        padding: 1rem;
        border-radius: 5px;
        margin-top: 1rem;
        text-align: center;
    }

    .payment-message.success {
        background-color: #2e7d32;
        color: white;
        display: block;
    }

    .payment-message.error {
        background-color: #c62828;
        color: white;
        display: block;
    }

    .confirmation-screen {
        text-align: center;
        padding: 40px;
        background-color: rgba(255, 255, 255, 0.05);
        border-radius: 15px;
        margin-top: 50px;
        animation: fadeIn 1s ease-out;
        display: none;
    }

        /* Estilo para checkboxes cuadrados con X cuando están seleccionados */
    input[type="radio"]:checked::before {
        content: "✕";
        position: absolute;
        top: -2px;
        left: 2px;
        font-size: 14px;
        font-weight: bold;
        color: var(--primary-gold);
    }
    
    /* Cambiar color del borde cuando está seleccionado */
    input[type="radio"]:checked {
        border-color: var(--secondary-gold);
        background-color: rgba(184, 172, 132, 0.1);
    }
    
    /* Estilo para el hover */
    input[type="radio"]:hover {
        border-color: var(--secondary-gold);
    }

        /* Estilo para checkboxes cuadrados con X cuando están seleccionados */
    input[type="checkbox"]:checked::before {
        content: "✕";
        position: absolute;
        top: -2px;
        left: 2px;
        font-size: 14px;
        font-weight: bold;
        color: var(--primary-gold);
    }
    
    /* Cambiar color del borde cuando está seleccionado */
    input[type="checkbox"]:checked {
        border-color: var(--secondary-gold);
        background-color: rgba(184, 172, 132, 0.1);
    }
    
    /* Estilo para el hover */
    input[type="checkbox"]:hover {
        border-color: var(--secondary-gold);
    }

        .edit-btn {
        background: transparent;
        border: 1px solid var(--primary-gold);
        color: var(--primary-gold);
        padding: 5px 10px;
        border-radius: 5px;
        cursor: pointer;
        font-size: 0.8rem;
        margin-left: 10px;
    }

    .edit-btn:hover {
        background: rgba(184, 172, 132, 0.1);
    }

    .summary-section {
        margin-bottom: 20px;
        padding-bottom: 15px;
        border-bottom: 1px solid rgba(184, 172, 132, 0.3);
    }

    .summary-section h4 {
        display: flex;
        justify-content: space-between;
        align-items: center;
        color: var(--primary-gold);
        margin-bottom: 15px;
    }

        #confirmationButton {
        background: var(--secondary-gold);
        border: none;
        padding: 12px 25px;
        border-radius: 8px;
        color: var(--secondary-blue);
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s;
        margin-top: 20px;
    }
    
    #confirmationButton:hover {
        background: var(--primary-gold);
        transform: translateY(-2px);
    }
    
    #confirmationButton:disabled {
        opacity: 0.6;
        cursor: not-allowed;
    }

        #player-name-display,
    #player-dni-display,
    #player-address-display {
        color: var(--primary-gold);
        font-weight: bold;
    }

      .confirmation-steps {
        margin: 25px 0;
        border: 1px solid rgba(184, 172, 132, 0.3);
        border-radius: 10px;
        overflow: hidden;
    }

    .confirmation-step-item {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 20px;
        border-bottom: 1px solid rgba(184, 172, 132, 0.2);
        background-color: rgba(255, 255, 255, 0.03);
    }

    .confirmation-step-item:last-child {
        border-bottom: none;
    }

    .confirmation-step-info h4 {
        color: var(--primary-gold);
        margin: 0 0 5px 0;
        font-size: 1.1rem;
    }

    .confirmation-step-info p {
        color: #ccc;
        margin: 0;
        font-size: 0.9rem;
    }

    .confirmation-total {
        text-align: center;
        padding: 20px;
        background-color: rgba(184, 172, 132, 0.1);
        border-radius: 8px;
        margin: 25px 0;
    }

    .confirmation-total h4 {
        color: var(--primary-gold);
        font-size: 1.3rem;
        margin: 0 0 10px 0;
    }

    .confirmation-note {
        color: #ccc;
        font-size: 0.9rem;
        margin: 0;
    }

    .edit-btn {
        background: transparent;
        border: 1px solid var(--primary-gold);
        color: var(--primary-gold);
        padding: 10px 15px;
        border-radius: 6px;
        cursor: pointer;
        font-size: 0.9rem;
        transition: all 0.3s;
        white-space: nowrap;
    }

    .edit-btn:hover {
        background: rgba(184, 172, 132, 0.1);
        transform: translateY(-2px);
    }

.welcome-screen {
    max-width: 800px;
    margin: 0 auto;
    padding: 1.5rem;
    background: var(--primary-blue);
    border-radius: 10px;
    box-shadow: 0 5px 20px rgba(0, 0, 0, 0.2);
    color: white;
}

.welcome-header {
    text-align: center;
    margin-bottom: 1.5rem;
    padding-bottom: 0.8rem;
    border-bottom: 1px solid var(--primary-gold);
}

.welcome-header h1 {
    color: var(--primary-gold);
    margin-bottom: 0.3rem;
    font-size: 1.5rem;
}

.welcome-header p {
    margin: 0;
    font-size: 0.85rem;
    color: #ccc;
}

.process-guide h2 {
    color: var(--primary-gold);
    margin: 0 0 0.8rem 0;
    font-size: 1.1rem;
    text-align: center;
}

.steps-grid {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 0.4rem;
    margin-bottom: 1rem;
    text-align: center;
    margin: 0 auto;    
    align-items: center;
}
.step-item {
    display: flex;
    flex-direction: column;
    align-items: center;
    text-align: center;
    padding: 0.6rem 0.4rem;
    background: rgba(255, 255, 255, 0.04);
    border-radius: 6px;
    border: 1px solid rgba(184, 134, 11, 0.2);
    transition: all 0.2s ease;
    min-height: 70px;
}

.step-item:hover {
    border-color: var(--primary-gold);
    background: rgba(184, 134, 11, 0.05);
}

.step-number {
    display: flex;
    align-items: center;
    justify-content: center;
    width: 20px;
    height: 20px;
    background-color: var(--primary-gold);
    color: white;
    border-radius: 50%;
    font-weight: bold;
    margin-bottom: 0.4rem;
    font-size: 10px;
}

.step-info h3 {
    margin: 0 0 0.2rem 0;
    color: var(--primary-gold);
    font-size: 10px;
    font-weight: 600;
}

.step-info p {
    margin: 0;
    color: #bbb;
    font-size: 8px;
}

.important-notice {
    text-align: center;
    max-width: 350px;
    margin: 0 auto;
}

.notice-content ul {
    padding-left: 0;
    list-style-position: inside;
    text-align: left;
    display: inline-block;
}

.welcome-actions {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 0.6rem;
}

.primary-button {
    background-color: var(--primary-gold);
    color: var(--primary-blue);
    border: none;
    padding: 0.7rem 1.8rem;
    border-radius: 5px;
    font-weight: bold;
    cursor: pointer;
    transition: all 0.2s;
    font-size: 15px;
}

.primary-button:hover {
    background-color: var(--secondary-gold);
    transform: scale(1.02);
}

/* Responsive */
@media (max-width: 768px) {
    .steps-grid {
        grid-template-columns: repeat(2, 1fr);
    }
}

@media (max-width: 480px) {
    .welcome-screen {
        padding: 1rem;
    }
    
    .steps-grid {
        grid-template-columns: 1fr;
        gap: 0.5rem;
    }
    
    .step-item {
        flex-direction: row;
        text-align: left;
        padding: 0.5rem;
        min-height: auto;
    }
    
    .step-number {
        margin-right: 0.6rem;
        margin-bottom: 0;
    }
}

    @media (max-width: 600px) {
        .steps-menu {
            grid-template-columns: repeat(3, 1fr);
        }
    }

    @media (max-width: 480px) {
        .steps-menu {
            grid-template-columns: repeat(2, 1fr);
        }

        .navigation-buttons {
            flex-direction: column;
            gap: 10px;
        }

        button {
            width: 100%;
        }

        .welcome-screen button {
            width: auto;
        }
    }

    /* Sección de pago más ancha */
.stripe-payment-container {
    width: 100% !important;
    max-width: 100% !important;
    padding: 20px;
}
.StripeElement {
    box-sizing: border-box;
    height: 40px;
    padding: 10px 12px;
    border: 1px solid transparent;
    border-radius: 4px;
    background-color: white;
    box-shadow: 0 1px 3px 0 #e6ebf1;
    transition: box-shadow 150ms ease;
}

.StripeElement--focus {
    box-shadow: 0 1px 3px 0 #cfd7df;
}

.StripeElement--invalid {
    border-color: #fa755a;
}

.StripeElement--webkit-autofill {
    background-color: #fefde5 !important;
}

#stripe-payment-message {
    color: rgb(105, 115, 134);
    font-size: 16px;
    line-height: 20px;
    padding: 12px 16px;
    border-radius: 4px;
    margin-bottom: 16px;
    background-color: #f8f9fa;
}

#stripe-payment-message.error {
    color: #fa755a;
    background-color: #fff5f5;
}

.spinner {
    border: 2px solid #f3f3f3;
    border-top: 2px solid #3498db;
    border-radius: 50%;
    width: 16px;
    height: 16px;
    animation: spin 1s linear infinite;
    display: inline-block;
    margin-right: 8px;
}

@keyframes spin {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
}

.hidden {
    display: none;
}

.success-icon {
    font-size: 40px;
    color: #52c41a;
    margin-bottom: 16px;
}

.modal {
    position: fixed;
    z-index: 10000;
    left: 0;
    top: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0, 0, 0, 0.8);
    display: flex;
    justify-content: center;
    align-items: center;
    padding: 20px;
    box-sizing: border-box;
}

.modal-content {
    background: var(--primary-blue);
    border: 2px solid var(--primary-gold);
    border-radius: 12px;
    padding: 0;
    width: 100%;
    max-width: 600px;
    max-height: 90vh;
    overflow: hidden;
    display: flex;
    flex-direction: column;
    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
}

.modal-header {
    background: var(--secondary-blue);
    padding: 20px;
    border-bottom: 2px solid var(--primary-gold);
}

.modal-header h2 {
    margin: 0;
    color: var(--primary-gold);
    text-align: center;
}

.close-modal {
    position: absolute;
    top: 15px;
    right: 20px;
    font-size: 28px;
    font-weight: bold;
    color: var(--primary-gold);
    cursor: pointer;
    z-index: 10001;
}

.close-modal:hover {
    color: white;
}

.payment-summary {
    padding: 20px;
    background: rgba(255, 255, 255, 0.05);
    margin: 0;
}

.payment-summary h3 {
    margin: 0 0 15px 0;
    color: var(--primary-gold);
    font-size: 1.2em;
}

.summary-item {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 10px;
    padding: 8px 0;
    border-bottom: 1px solid rgba(184, 172, 132, 0.3);
}

.summary-item.total {
    border-top: 2px solid var(--primary-gold);
    border-bottom: none;
    margin-top: 15px;
    padding-top: 15px;
    font-size: 1.1em;
}

.summary-item:last-child {
    border-bottom: none;
}

.stripe-payment-container {
    padding: 20px;
    flex: 1;
    overflow-y: auto;
}

.form-group {
    margin-bottom: 20px;
}

.form-group label {
    display: block;
    margin-bottom: 8px;
    color: var(--primary-gold);
    font-weight: 500;
}

.stripe-element-container {
    background: white;
    border-radius: 8px;
    padding: 5px;
    border: 1px solid #ddd;
}

/* Elementos de Stripe mejorados */
.StripeElement {
    padding: 12px 15px;
    font-size: 16px;
    color: #32325d !important;
    background: white !important;
    border: none !important;
    border-radius: 6px;
    height: auto !important;
}

.StripeElement--focus {
    box-shadow: 0 0 0 2px var(--primary-gold) !important;
    outline: none;
}

.StripeElement--invalid {
    border-color: #ff3860 !important;
}

.stripe-actions {
    display: flex;
    gap: 15px;
    margin-top: 25px;
    padding-top: 20px;
    border-top: 1px solid rgba(184, 172, 132, 0.3);
}

.stripe-actions button {
    flex: 1;
    padding: 12px;
    border-radius: 6px;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s ease;
}

.primary-btn {
    background: var(--primary-gold);
    color: var(--primary-blue);
    border: none;
}

.primary-btn:hover {
    background: #d4af37;
    transform: translateY(-1px);
}

.secondary-btn {
    background: var(--secondary-blue);
    color: white;
    border: 1px solid var(--primary-gold);
}

.secondary-btn:hover {
    background: rgba(184, 172, 132, 0.1);
}

/* Scroll personalizado para el modal */
.stripe-payment-container::-webkit-scrollbar {
    width: 6px;
}

.stripe-payment-container::-webkit-scrollbar-track {
    background: rgba(255, 255, 255, 0.1);
    border-radius: 3px;
}

.stripe-payment-container::-webkit-scrollbar-thumb {
    background: var(--primary-gold);
    border-radius: 3px;
}

.stripe-payment-container::-webkit-scrollbar-thumb:hover {
    background: #d4af37;
}

/* Spinner */
.spinner {
    border: 2px solid #f3f3f3;
    border-top: 2px solid var(--primary-blue);
    border-radius: 50%;
    width: 16px;
    height: 16px;
    animation: spin 1s linear infinite;
    display: inline-block;
    margin-right: 8px;
}

.StripeElement input {
    color: #000000 !important;
    background-color: #ffffff !important;
    font-size: 16px !important;
    padding: 12px 15px !important;
}

.StripeElement {
    color: #000000 !important;
    background-color: #ffffff !important;
    padding: 10px !important;
}

@keyframes spin {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
}

.hidden {
    display: none;
}

/* Responsive */
@media (max-width: 600px) {
    .modal {
        padding: 10px;
    }
    
    .modal-content {
        max-width: 100%;
        max-height: 95vh;
    }
    
    .stripe-actions {
        flex-direction: column;
    }
    
    .payment-summary,
    .stripe-payment-container {
        padding: 15px;
    }
}

/* Fondo blanco forzado para TODOS los elementos de Stripe */
.StripeElement,
.StripeElement *,
.StripeElement input,
.StripeElement iframe,
[class*="Stripe"],
[class*="stripe"] {
    background: white !important;
    color: black !important;
    font-size: 16px !important;

width: 100% !important;
    min-width: 100% !important;
}

/* Contenedor principal con fondo blanco */
#payment-element {
    background: white !important;
    padding: 15px;
    border-radius: 8px;
    border: 1px solid #ddd;
        width: 100% !important;
    min-width: 100% !important;
}

/* Fuerza colores visibles */
.StripeElement--complete,
.StripeElement--focus,
.StripeElement--invalid {
    background: white !important;
    color: black !important;
}

/* Inputs específicos */
.StripeElement input {
    background: white !important;
    color: #000000 !important;
    font-size: 16px !important;
    padding: 12px !important;
    border: 1px solid #ccc !important;
    border-radius: 4px !important;
}

/* Labels visibles */
.StripeElement label {
    color: #000000 !important;
    font-weight: bold !important;
}
</style>

<script src="https://js.stripe.com/v3/">

    // Debug: verificar clave y endpoint
        console.log('Clave Stripe:', 'pk_test_51S3aPM2W7WhI0yvpQSVeGOHZEm8NfImrt2ZVXR34EkzevVoW6DDSVL6xpcY4FhuNWqzXbDN616c1MEWrrNyiQiiC00xOrROFOh'); // Reemplaza con tu clave real
        console.log('Endpoint:', '/create-payment-intent/');
</script>


<div class="welcome-screen" id="welcomeScreen">
    <div class="welcome-header">
        <h1>Inscripción - Club Olympia</h1>
        <p>Abriendo camino, cumpliendo sueños desde 2015</p>
    </div>

    <div class="welcome-content">
        <div class="process-guide">
            <h2>Proceso en 6 pasos</h2>

            <div class="steps-grid">
                <div class="step-item">
                    <div class="step-number">1</div>
                    <div class="step-info">
                        <h3>Datos Personales</h3>
                        <p>Jugadora y tutores</p>
                    </div>
                </div>

                <div class="step-item">
                    <div class="step-number">2</div>
                    <div class="step-info">
                        <h3>Datos Bancarios</h3>
                        <p>Para domiciliación</p>
                    </div>
                </div>

                <div class="step-item">
                    <div class="step-number">3</div>
                    <div class="step-info">
                        <h3>Autorización</h3>
                        <p>Para menores</p>
                    </div>
                </div>

                <div class="step-item">
                    <div class="step-number">4</div>
                    <div class="step-info">
                        <h3>Protección Datos</h3>
                        <p>Consentimientos</p>
                    </div>
                </div>

                <div class="step-item">
                    <div class="step-number">5</div>
                    <div class="step-info">
                        <h3>Compromiso</h3>
                        <p>Normas del club</p>
                    </div>
                </div>

                <div class="step-item">
                    <div class="step-number">6</div>
                    <div class="step-info">
                        <h3>Confirmación</h3>
                        <p>Y pago final</p>
                    </div>
                </div>
            </div>
        </div>

        <div class="important-notice">
            <div class="notice-header">
                <span>⚠️</span>
                <h3>Importante</h3>
            </div>
                <div class="notice-content">
                    <ul>
                        <ul>Completa <strong>todos los pasos</strong> para guardar tu información</ul>
                        <ul>La inscripción solo es válida tras el <strong>pago final</strong></ul>
                        <ul>Al terminar, realizarás el pago mediante nuestra app</ul>
                        <ul><strong>Pago único: 130€</strong></ul>
                        <ul>Si abandonas, deberás comenzar desde cero</ul>
                        <ul>Tiempo estimado: 15-20 minutos</ul>
                    </ul>
                </div>
        </div>
    </div>

    <div class="welcome-actions">
        <button class="primary-button" onclick="startRegistration()">Comenzar inscripción</button>
    </div>
</div>

<!-- Paso 1: Información Personal -->
<div class="form-container" id="step1Form">
    <h2>Información Personal</h2>

    <div class="form-group">
        <label for="full-name">Nombre completo*</label>
        <input type="text" id="full-name" name="full-name" placeholder="Escribe tu nombre completo" required>
        <div class="error-message" id="full-name_error"></div>
    </div>

    <div class="form-group">
        <label for="birthdate">Fecha de Nacimiento*</label>
        <input type="date" id="birthdate" name="birthdate" required>
        <div class="error-message" id="birthdate_error"></div>
    </div>

    <div class="form-group">
        <label for="category">Categoría*</label>
        <select id="category" name="category" required>
            <option value="">Selecciona una categoría</option>
            <option value="Olympeques (2020-2021)">Olympeques (2020-2021)</option>
            <option value="Benjamín">Benjamín</option>
            <option value="Alevín">Alevín</option>
            <option value="Infantil">Infantil</option>
            <option value="Cadete">Cadete</option>
            <option value="Juvenil">Juvenil</option>
            <option value="Senior">Senior</option>
        </select>
        <div class="error-message" id="category_error"></div>
    </div>

    <div class="form-group">
        <label for="birth-municipality">Municipio de Nacimiento*</label>
        <input type="text" id="birth-municipality" name="birth-municipality"
            placeholder="Escribe tu municipio de nacimiento" required>
        <div class="error-message" id="birth-municipality_error"></div>
    </div>

    <div class="form-group">
        <label for="empadronamiento">Empadronada en*</label>
        <input type="text" id="empadronamiento" name="empadronamiento"
            placeholder="Escribe tu municipio de empadronamiento" required>
        <div class="error-message" id="empadronamiento_error"></div>
    </div>

    <div class="form-group">
        <label for="player-dni">DNI Jugadora (mayores de 14)</label>
        <input type="text" id="player-dni" name="player-dni" placeholder="Escribe tu DNI">
        <div class="error-message" id="player-dni_error"></div>
    </div>

    <div class="form-group">
        <label for="email">Email Jugadora (mayores de edad)</label>
        <input type="email" id="email" name="email" placeholder="Escribe tu email">
        <div class="error-message" id="email_error"></div>
    </div>

    <div class="form-group">
        <label for="phone">Teléfono Jugadora (mayores de edad)</label>
        <input type="tel" id="phone" name="phone" placeholder="Escribe tu teléfono">
        <div class="error-message" id="phone_error"></div>
    </div>

    <div class="form-group">
        <label for="landline">Teléfono Fijo*</label>
        <input type="tel" id="landline" name="landline" placeholder="Escribe tu teléfono fijo" required>
        <div class="error-message" id="landline_error"></div>
    </div>

    <div class="form-group">
        <label for="address">Domicilio*</label>
        <input type="text" id="address" name="address" placeholder="Escribe tu dirección" required>
        <div class="error-message" id="address_error"></div>
    </div>

    <div class="form-group">
        <label for="city">Población*</label>
        <input type="text" id="city" name="city" placeholder="Escribe tu población" required>
        <div class="error-message" id="city_error"></div>
    </div>

    <div class="form-group">
        <label for="zip-code">Código Postal*</label>
        <input type="text" id="zip-code" name="zip-code" placeholder="Escribe tu código postal" required>
        <div class="error-message" id="zip-code_error"></div>
    </div>

    <div class="form-group">
        <label style="display: block; margin-bottom: 10px; font-weight: 500; color: var(--primary-gold);">¿Has jugado al
            fútbol antes?*</label>
        <div style="display: flex; align-items: center; gap: 15px;">
            <label style="display: flex; align-items: center; cursor: pointer;">
                <input type="radio" id="played-before-yes" name="played-before" value="si" required style="appearance: none; width: 18px; height: 18px; border: 2px solid var(--primary-gold); 
                              border-radius: 3px; margin-right: 8px; position: relative;">
                Sí
            </label>
            <label style="display: flex; align-items: center; cursor: pointer;">
                <input type="radio" id="played-before-no" name="played-before" value="no" style="appearance: none; width: 18px; height: 18px; border: 2px solid var(--primary-gold); 
                              border-radius: 3px; margin-right: 8px; position: relative;">
                No
            </label>
        </div>
        <div class="error-message" id="played-before_error"></div>
    </div>

    <div class="form-group" id="previous-teams-container" style="display: none;">
        <label for="previous-teams">En caso afirmativo, cuéntanos en qué equipos y cuál es tu posición</label>
        <textarea id="previous-teams" name="previous-teams" placeholder="Equipos anteriores y posición"></textarea>
        <div class="error-message" id="previous-teams_error"></div>
    </div>

    <!-- Datos de la Madre/Tutor -->
    <div class="form-group">
        <label for="mother-name">Nombre Completo Madre/Tutor*</label>
        <input type="text" id="mother-name" name="mother-name" placeholder="Escribe aquí" required>
        <div class="error-message" id="mother-name_error"></div>
    </div>
    
    <div class="form-group">
        <label for="mother-dni">DNI Madre/Tutor*</label>
        <input type="text" id="mother-dni" name="mother-dni" placeholder="Escribe aquí" required>
        <div class="error-message" id="mother-dni_error"></div>
    </div>
    
    <div class="form-group">
        <label for="mother-email">Email Madre/Tutor*</label>
        <input type="email" id="mother-email" name="mother-email" placeholder="Escribe aquí" required>
        <div class="error-message" id="mother-email_error"></div>
    </div>
    
    <div class="form-group">
        <label for="mother-phone">Teléfono Madre/Tutor*</label>
        <input type="tel" id="mother-phone" name="mother-phone" placeholder="Escribe aquí" required>
        <div class="error-message" id="mother-phone_error"></div>
    </div>
    
    <div class="form-group">
        <label for="mother-birthplace">Lugar Nacimiento Madre/Tutor*</label>
        <input type="text" id="mother-birthplace" name="mother-birthplace" placeholder="Escribe aquí" required>
        <div class="error-message" id="mother-birthplace_error"></div>
    </div>
    
    <!-- Datos del Padre -->
    <div class="form-group">
        <label for="father-name">Nombre Completo Padre</label>
        <input type="text" id="father-name" name="father-name" placeholder="Escribe aquí">
        <div class="error-message" id="father-name_error"></div>
    </div>
    
    <div class="form-group">
        <label for="father-dni">DNI Padre</label>
        <input type="text" id="father-dni" name="father-dni" placeholder="Escribe aquí">
        <div class="error-message" id="father-dni_error"></div>
    </div>
    
    <div class="form-group">
        <label for="father-email">Email Padre</label>
        <input type="email" id="father-email" name="father-email" placeholder="Escribe aquí">
        <div class="error-message" id="father-email_error"></div>
    </div>
    
    <div class="form-group">
        <label for="father-phone">Teléfono Padre</label>
        <input type="tel" id="father-phone" name="father-phone" placeholder="Escribe aquí">
        <div class="error-message" id="father-phone_error"></div>
    </div>
    
    <div class="form-group">
        <label for="father-birthplace">Lugar Nacimiento Padre</label>
        <input type="text" id="father-birthplace" name="father-birthplace" placeholder="Escribe aquí">
        <div class="error-message" id="father-birthplace_error"></div>
    </div>
    
    <!-- Checkboxes de consentimiento con enlaces -->
    <div class="form-group">
        <label style="display: block; margin-bottom: 10px; font-weight: 500; color: var(--primary-gold);">
            Acepto las <a href="https://www.cffolympia.es/public/docs/Normas%20y%20Requistos%20del%20CFF%20Olympia.pdf"
                target="_blank" style="color: var(--primary-gold); text-decoration: underline;">normas y requisitos del
                club</a>.*
        </label>
        <div style="display: flex; align-items: center;">
            <label style="display: flex; align-items: center; cursor: pointer;">
                <input type="checkbox" id="club-rules" name="club-rules" required style="appearance: none; width: 18px; height: 18px; border: 2px solid var(--primary-gold); 
                              border-radius: 3px; margin-right: 8px; position: relative;">
                Sí, acepto
            </label>
        </div>
        <div class="error-message" id="club-rules_error"></div>
    </div>
    
    <div class="form-group">
        <label style="display: block; margin-bottom: 10px; font-weight: 500; color: var(--primary-gold);">
            Acepto la <a
                href="https://www.cffolympia.es/public/docs/Pol%C3%ADtica%20de%20privacidad%20CFF%20Olympia%20Las%20Rozas.pdf"
                target="_blank" style="color: var(--primary-gold); text-decoration: underline;">política de privacidad</a>.*
        </label>
        <div style="display: flex; align-items: center;">
            <label style="display: flex; align-items: center; cursor: pointer;">
                <input type="checkbox" id="privacy-policy" name="privacy-policy" required style="appearance: none; width: 18px; height: 18px; border: 2px solid var(--primary-gold); 
                              border-radius: 3px; margin-right: 8px; position: relative;">
                Sí, acepto
            </label>
        </div>
        <p style="font-size: 0.9rem; color: #ccc; margin-top: 5px; margin-left: 25px;">
            Si no nos permite utilizar estos datos es posible que no podamos prestarle los servicios solicitados,
            pues tal información es necesaria para que podamos desarrollar nuestra actividad de manera coherente y efectiva.
        </p>
        <div class="error-message" id="privacy-policy_error"></div>
    </div>
    
    <div class="form-group">
    <div class="checkbox-group" style="display: flex; align-items: flex-start;">
        <input type="checkbox" id="health-data" name="health-data" required 
               style="appearance: none; width: 18px; height: 18px; border: 2px solid var(--primary-gold); 
                      border-radius: 3px; margin-right: 8px; position: relative; flex-shrink: 0; margin-top: 3px;">
        <label for="health-data" style="cursor: pointer; margin: 0;">Consiento el uso de los datos relativos a mi salud o, en su caso, como tutores a la
            salud de mi hijo o menor a nuestro cargo para poder recibir los servicios solicitados.*</label>
    </div>
    <div class="error-message" id="health-data_error"></div>
</div>

<div class="form-group">
    <div class="checkbox-group" style="display: flex; align-items: flex-start;">
        <input type="checkbox" id="social-media-image" name="social-media-image"
               style="appearance: none; width: 18px; height: 18px; border: 2px solid var(--primary-gold); 
                      border-radius: 3px; margin-right: 8px; position: relative; flex-shrink: 0; margin-top: 3px;">
        <label for="social-media-image" style="cursor: pointer; margin: 0;">Consiento que se utilice mi imagen o, en su caso, como tutores la imagen de
            nuestro hijo o menor a nuestro cargo para su publicación a través de las redes sociales con el fin de dar a
            conocer la entidad y difundir su actividad.</label>
    </div>
</div>

<div class="form-group">
    <div class="checkbox-group" style="display: flex; align-items: flex-start;">
        <input type="checkbox" id="internet-image" name="internet-image"
               style="appearance: none; width: 18px; height: 18px; border: 2px solid var(--primary-gold); 
                      border-radius: 3px; margin-right: 8px; position: relative; flex-shrink: 0; margin-top: 3px;">
        <label for="internet-image" style="cursor: pointer; margin: 0;">Consiento la publicación de mi imagen o, en su caso, la imagen de nuestro hijo o
            menor a nuestro cargo en Internet y otros medios similares para difundir las actividades de su
            entidad.</label>
    </div>
</div>

<div class="form-group">
    <div class="checkbox-group" style="display: flex; align-items: flex-start;">
        <input type="checkbox" id="marketing" name="marketing"
               style="appearance: none; width: 18px; height: 18px; border: 2px solid var(--primary-gold); 
                      border-radius: 3px; margin-right: 8px; position: relative; flex-shrink: 0; margin-top: 3px;">
        <label for="marketing" style="cursor: pointer; margin: 0;">Consiento el uso de mis datos personales para recibir publicidad de su entidad.</label>
    </div>
</div>
    
    <div class="form-group">
        <p style="font-size: 0.9rem; color: #ccc; margin-top: 10px;">
            Podrá retirar cualquiera de estos consentimientos cuando lo considere oportuno.
        </p>
    </div>

    <div class="navigation-buttons">
        <button type="button" class="secondary" onclick="backToStart()">Volver al menú</button>
        <button type="button" id="step1Button" onclick="saveStep(1)">Continuar</button>
    </div>
    <!-- En CADA paso (1-5), añade este botón: -->
    <div style="text-align: center; margin-top: 20px;">
        <button type="button" id="confirmationButton" onclick="goToConfirmation()"
            style="display: none; background: var(--secondary-gold);">
            Ir a Confirmación
        </button>
    </div>
</div>

<!-- Paso 2: Domiciliación Bancaria -->
<div class="form-container" id="step2Form">
    <h2>Orden de Domiciliación de Adeudo Directo SEPA</h2>

    <div style="background-color: rgba(255,255,255,0.05); padding: 20px; border-radius: 10px; margin-bottom: 20px;">
        <p style="text-align: center; font-style: italic; color: var(--primary-gold);">
            CFF OLYMPIA LAS ROZAS<br>
            Abriendo camino, cumpliendo sueños desde 2015
        </p>
    </div>

    <div class="form-group">
        <label for="signature-date">En las Rozas de Madrid, a _____ de _________________ de 2.02__*</label>
        <input type="date" id="signature-date" name="signature-date" required>
        <div class="error-message" id="signature-date_error"></div>
    </div>

    <div style="background-color: rgba(184, 172, 132, 0.1); padding: 15px; border-radius: 8px; margin-bottom: 20px;">
        <h4 style="color: var(--primary-gold); margin-bottom: 10px;">DATOS DEL CLUB</h4>
        <p>• Identificador del acreedor: <strong>G87362638</strong></p>
        <p>• Nombre del acreedor: <strong>CLUB DEPORTIVO BÁSICO FÚTBOL FEMENINO OLYMPIA LAS ROZAS</strong></p>
        <p>• Dirección del acreedor: <strong>CALLE TERUEL 3, 28231 LAS ROZAS DE MADRID, ESPAÑA</strong></p>
    </div>

    <div class="form-group">
        <label for="account-holder">Nombre y Apellidos del Titular de la Cuenta*</label>
        <input type="text" id="account-holder" name="account-holder" placeholder="Nombre completo del titular" required>
        <div class="error-message" id="account-holder_error"></div>
    </div>

    <div class="form-group">
        <label for="account-holder-dni">DNI del Titular de la Cuenta*</label>
        <input type="text" id="account-holder-dni" name="account-holder-dni" placeholder="DNI del titular" required>
        <div class="error-message" id="account-holder-dni_error"></div>
    </div>

    <div class="form-group">
        <label for="account-holder-address">Domicilio del Titular*</label>
        <input type="text" id="account-holder-address" name="account-holder-address" placeholder="Dirección completa"
            required>
        <div class="error-message" id="account-holder-address_error"></div>
    </div>

    <div class="form-group">
        <label for="account-holder-zip">Código Postal*</label>
        <input type="text" id="account-holder-zip" name="account-holder-zip" placeholder="Código postal" required>
        <div class="error-message" id="account-holder-zip_error"></div>
    </div>

    <div class="form-group">
        <label for="account-holder-city">Población*</label>
        <input type="text" id="account-holder-city" name="account-holder-city" placeholder="Población" required>
        <div class="error-message" id="account-holder-city_error"></div>
    </div>

    <div class="form-group">
        <label for="account-holder-province">Provincia*</label>
        <input type="text" id="account-holder-province" name="account-holder-province" placeholder="Provincia" required>
        <div class="error-message" id="account-holder-province_error"></div>
    </div>

    <div class="form-group">
        <label for="swift-code">SWIFT Code (entre 8 y 11 caracteres)</label>
        <input type="text" id="swift-code" name="swift-code" placeholder="Código SWIFT">
        <div class="error-message" id="swift-code_error"></div>
    </div>

    <div class="form-group">
        <label for="iban">IBAN - Número de cuenta*</label>
        <input type="text" id="iban" name="iban" placeholder="ESXX XXXX XXXX XXXX XXXX XXXX" required>
        <div class="error-message" id="iban_error"></div>
    </div>

    <div class="form-group">
        <label>Tipo de Pago*</label>
        <div style="display: flex; align-items: center; gap: 20px;">
            <label style="display: flex; align-items: center; cursor: pointer;">
                <input type="radio" id="payment-type-recurrent" name="payment-type" value="recurrent" required style="appearance: none; width: 18px; height: 18px; border: 2px solid var(--primary-gold); 
                              border-radius: 3px; margin-right: 8px; position: relative;">
                Pago Recurrente
            </label>
            <label style="display: flex; align-items: center; cursor: pointer;">
                <input type="radio" id="payment-type-single" name="payment-type" value="single" style="appearance: none; width: 18px; height: 18px; border: 2px solid var(--primary-gold); 
                              border-radius: 3px; margin-right: 8px; position: relative;">
                Pago Único
            </label>
        </div>
        <div class="error-message" id="payment-type_error"></div>
    </div>

    <div class="navigation-buttons">
        <button type="button" class="secondary" onclick="navigateToStep(1)">Anterior</button>
        <button type="button" id="step2Button" onclick="saveStep(2)">Guardar y continuar</button>
        <!-- En CADA paso (1-5), añade este botón: -->
        <div style="text-align: center; margin-top: 20px;">
            <button type="button" id="confirmationButton" onclick="goToConfirmation()"
                style="display: none; background: var(--secondary-gold);">
                Ir a Confirmación
            </button>
        </div>
    </div>

</div>

<!-- Paso 3: Autorización para Menores -->
<div class="form-container" id="step3Form">
    <h2>Autorización para Inscribir a un Menor de Edad</h2>

    <div style="background-color: rgba(255,255,255,0.05); padding: 20px; border-radius: 10px; margin-bottom: 20px;">
        <p style="text-align: center; font-style: italic; color: var(--primary-gold);">
            CFF OLYMPIA LAS ROZAS<br>
            Abriendo camino, cumpliendo sueños desde 2015
        </p>
    </div>

    <div class="form-group">
        <label for="authorization-date">En las Rozas de Madrid, a _____ de _________________ de 2.0___*</label>
        <input type="date" id="authorization-date" name="authorization-date" required>
        <div class="error-message" id="authorization-date_error"></div>
    </div>

    <div style="background-color: rgba(184, 172, 132, 0.1); padding: 15px; border-radius: 8px; margin-bottom: 20px;">
        <h4 style="color: var(--primary-gold); margin-bottom: 10px;">A RELLENAR POR EL TUTOR O REPRESENTANTE:</h4>
        <p>Por medio de la presente, el/los abajo firmante/s, ostentando, individual o conjuntamente,
            la patria potestad o tutela de la menor <strong id="player-name-display"></strong>,
            con DNI/NIE/Nº de pasaporte <strong id="player-dni-display"></strong>, y con domicilio
            en <strong id="player-address-display"></strong></p>
    </div>

    <div class="form-group">
        <label for="mother-signature-name">Nombre y Apellidos (Madre/Tutora)*</label>
        <input type="text" id="mother-signature-name" name="mother-signature-name" required>
        <div class="error-message" id="mother-signature-name_error"></div>
    </div>

    <div class="form-group">
        <label for="mother-signature-dni">DNI/NIE/Pasaporte (Madre/Tutora)*</label>
        <input type="text" id="mother-signature-dni" name="mother-signature-dni" required>
        <div class="error-message" id="mother-signature-dni_error"></div>
    </div>

    <div class="form-group">
        <label for="mother-signature">Firma (Madre/Tutora)*</label>
        <input type="text" id="mother-signature" name="mother-signature"
            placeholder="Escriba su nombre completo como firma" required>
        <div class="error-message" id="mother-signature_error"></div>
    </div>

    <div class="form-group">
        <label for="father-signature-name">Nombre y Apellidos (Padre/Tutor)</label>
        <input type="text" id="father-signature-name" name="father-signature-name">
        <div class="error-message" id="father-signature-name_error"></div>
    </div>

    <div class="form-group">
        <label for="father-signature-dni">DNI/NIE/Pasaporte (Padre/Tutor)</label>
        <input type="text" id="father-signature-dni" name="father-signature-dni">
        <div class="error-message" id="father-signature-dni_error"></div>
    </div>

    <div class="form-group">
        <label for="father-signature">Firma (Padre/Tutor)</label>
        <input type="text" id="father-signature" name="father-signature"
            placeholder="Escriba su nombre completo como firma">
        <div class="error-message" id="father-signature_error"></div>
    </div>

    <div style="background-color: rgba(184, 172, 132, 0.1); padding: 15px; border-radius: 8px; margin-bottom: 20px;">
        <h4 style="color: var(--primary-gold); margin-bottom: 10px;">DECLARACIÓN RESPONSABLE</h4>
        <p style="font-size: 0.9rem; margin-bottom: 15px;">(Solo rellenar en el caso de ser un único progenitor)</p>

        <div class="form-group">
            <label for="single-parent-reason">Motivo de declaración responsable*</label>
            <select id="single-parent-reason" name="single-parent-reason">
                <option value="">Seleccione el motivo</option>
                <option value="monoparental">Familia monoparental</option>
                <option value="fallecimiento">Fallecimiento del otro progenitor</option>
                <option value="privacion">Privación de la patria potestad por resolución judicial</option>
                <option value="alejamiento">Orden o sentencia de alejamiento</option>
                <option value="consentimiento">Consentimiento expreso del otro progenitor</option>
                <option value="otras">Otras circunstancias</option>
            </select>
            <div class="error-message" id="single-parent-reason_error"></div>
        </div>

        <div class="form-group" id="other-reason-container" style="display: none;">
            <label for="other-reason">Especifique otras circunstancias</label>
            <textarea id="other-reason" name="other-reason" placeholder="Describa las circunstancias"></textarea>
            <div class="error-message" id="other-reason_error"></div>
        </div>
    </div>

    <div class="navigation-buttons">
        <button type="button" class="secondary" onclick="navigateToStep(2)">Anterior</button>
        <button type="button" id="step3Button" onclick="saveStep(3)">Guardar y continuar</button>
    </div>

    <div style="text-align: center; margin-top: 20px;">
        <button type="button" id="confirmationButton" onclick="goToConfirmation()"
            style="display: none; background: var(--secondary-gold);">
            Ir a Confirmación
        </button>
    </div>
</div>

<!-- Paso 4: Protección de Datos -->
<div class="form-container" id="step4Form">
    <h2>Anexo - Protección de Datos</h2>

    <div style="background-color: rgba(255,255,255,0.05); padding: 20px; border-radius: 10px; margin-bottom: 20px;">
        <p style="text-align: center; font-style: italic; color: var(--primary-gold);">
            CFF OLYMPIA LAS ROZAS<br>
            Abriendo camino, cumpliendo sueños desde 2015
        </p>
    </div>

    <div style="background-color: rgba(184, 172, 132, 0.1); padding: 15px; border-radius: 8px; margin-bottom: 20px;">
        <p>De conformidad con la normativa vigente y aplicable en protección de datos de
            carácter personal, le informamos que sus datos serán incorporados al sistema de
            tratamiento titularidad de Club de Fútbol Femenino Olympia Las Rozas con CIF
            G87362638 y domicilio social sito en calle Teruel 3, 28231 Las Rozas de Madrid, Madrid.</p>

        <p><strong>• Responsable del Tratamiento:</strong> CDB Fútbol Femenino Olympia Las Rozas</p>
        <p><strong>• Finalidad:</strong> Gestionar y facilitar el uso de la Web, el acceso a los servicios
            contratados, solucionar sus consultas, y la correcta organización, gestión y
            administración de aquellos trámites realizados a través de la Web del Club, así
            como dar soporte a cualquier duda, problema o reclamación que pudieran
            surgir con el uso de la Web. Envío por cualquier medio incluyendo por correo
            electrónico, u otra información equivalente de comunicación electrónica,
            publicidad o promociones sobre los productos o servicios del Club, de los
            patrocinadores del Club, siempre que haya prestado o solicitado su
            consentimiento y dándole la posibilidad de darse de baja en cada
            comunicación.</p>
        <p><strong>• Plazo de conservación:</strong> Mientras esté inscrita la jugadora en el club</p>
        <p><strong>• Base legítima:</strong> El interés legítimo de acuerdo con la legislación vigente y
            aplicable de protección de datos.</p>
        <p><strong>• Cesiones:</strong> Solo serán cedidos en caso de ser necesario a la/s entidad/es
            pública/s competente/s.</p>

        <p>De acuerdo con los derechos que le confiere la normativa vigente y aplicable en
            protección de datos podrá́ ejercer los derechos de acceso, rectificación, limitación de
            tratamiento, supresión ("derecho al olvido"), portabilidad y oposición al tratamiento de
            sus datos de carácter personal así como la revocación del consentimiento prestado
            para el tratamiento de los mismos, dirigiendo su petición a la dirección postal indicada
            más arriba o al correo electrónico: info@cffolympia.es.</p>

        <p>Si las personas interesadas entienden que se han visto perjudicadas por el tratamiento o en el
            ejercicio de sus derechos, pueden presentar una reclamación ante la Agencia Española de
            Protección de Datos a través de la sede electrónica accesible en la página web
            https://www.aepd.es/.</p>

        <p>El CDB Fútbol Femenino Olympia Las Rozas informa que con la firma del presente documento
            se otorga el consentimiento explícito para el tratamiento de los datos según las finalidades
            mencionadas anteriormente.</p>
    </div>

    <div class="form-group">
        <label for="data-protection-signature-name">Nombre y Apellidos*</label>
        <input type="text" id="data-protection-signature-name" name="data-protection-signature-name" required>
        <div class="error-message" id="data-protection-signature-name_error"></div>
    </div>

    <div class="form-group">
        <label for="data-protection-signature-dni">DNI/NIE/Pasaporte*</label>
        <input type="text" id="data-protection-signature-dni" name="data-protection-signature-dni" required>
        <div class="error-message" id="data-protection-signature-dni_error"></div>
    </div>

    <div class="form-group">
        <label for="data-protection-signature">Firma*</label>
        <input type="text" id="data-protection-signature" name="data-protection-signature"
            placeholder="Escriba su nombre completo como firma" required>
        <div class="error-message" id="data-protection-signature_error"></div>
    </div>

    <div class="form-group">
        <div class="checkbox-group" style="display: flex; align-items: flex-start;">
            <input type="checkbox" id="data-protection-consent" name="data-protection-consent" required style="appearance: none; width: 18px; height: 18px; border: 2px solid var(--primary-gold); 
                          border-radius: 3px; margin-right: 8px; position: relative; flex-shrink: 0; margin-top: 3px;">
            <label for="data-protection-consent" style="cursor: pointer; margin: 0;">Confirmo que he leído y comprendido
                la política de protección de datos y doy mi consentimiento explícito para el tratamiento de mis datos
                según las finalidades mencionadas anteriormente.*</label>
        </div>
        <div class="error-message" id="data-protection-consent_error"></div>
    </div>

    <div class="navigation-buttons">
        <button type="button" class="secondary" onclick="navigateToStep(3)">Anterior</button>
        <button type="button" id="step4Button" onclick="saveStep(4)">Guardar y continuar</button>
    </div>

    <div style="text-align: center; margin-top: 20px;">
        <button type="button" id="confirmationButton" onclick="goToConfirmation()"
            style="display: none; background: var(--secondary-gold);">
            Ir a Confirmación
        </button>
    </div>
</div>

<!-- Paso 5: Carta de Compromiso -->
<div class="form-container" id="step5Form">
    <h2>Carta de Compromiso</h2>

    <div style="background-color: rgba(255,255,255,0.05); padding: 20px; border-radius: 10px; margin-bottom: 20px;">
        <p style="text-align: center; font-style: italic; color: var(--primary-gold);">
            CFF OLYMPIA LAS ROZAS<br>
            Abriendo camino, cumpliendo sueños desde 2015
        </p>
    </div>

    <div class="form-group">
        <label for="commitment-date">En las Rozas de Madrid, a _____ de _________________ de 2.0___*</label>
        <input type="date" id="commitment-date" name="commitment-date" required>
        <div class="error-message" id="commitment-date_error"></div>
    </div>

    <div style="background-color: rgba(184, 172, 132, 0.1); padding: 15px; border-radius: 8px; margin-bottom: 20px;">
        <p><strong>Nombre de la jugadora:</strong> <span id="commitment-player-name"
                style="color: var(--primary-gold); font-weight: bold;"></span></p>
        <p><strong>DNI de la jugadora:</strong> <span id="commitment-player-dni"
                style="color: var(--primary-gold); font-weight: bold;"></span></p>
    </div>

    <div style="margin-bottom: 20px;">
        <h4 style="color: var(--primary-gold); margin-bottom: 15px;">COMPROMISOS:</h4>

        <div class="checkbox-group" style="display: flex; align-items: flex-start; margin-bottom: 15px;">
            <input type="checkbox" id="commitment-behavior" name="commitment-behavior" required style="appearance: none; width: 18px; height: 18px; border: 2px solid var(--primary-gold); 
                          border-radius: 3px; margin-right: 8px; position: relative; flex-shrink: 0; margin-top: 3px;">
            <label for="commitment-behavior" style="cursor: pointer; margin: 0;">A tener un comportamiento correcto y
                con respeto hacia los entrenadores, jugadores, directivos, adversarios, árbitros, público o empleados
                del club durante los entrenamientos, partidos, concentraciones y cualquier actividad que esté
                relacionado con el club.</label>
        </div>

        <div class="checkbox-group" style="display: flex; align-items: flex-start; margin-bottom: 15px;">
            <input type="checkbox" id="commitment-sportsmanship" name="commitment-sportsmanship" required style="appearance: none; width: 18px; height: 18px; border: 2px solid var(--primary-gold); 
                          border-radius: 3px; margin-right: 8px; position: relative; flex-shrink: 0; margin-top: 3px;">
            <label for="commitment-sportsmanship" style="cursor: pointer; margin: 0;">Aceptar las derrotas y las
                victorias con deportividad sin meterme con nadie.</label>
        </div>

        <div class="checkbox-group" style="display: flex; align-items: flex-start; margin-bottom: 15px;">
            <input type="checkbox" id="commitment-social-media" name="commitment-social-media" required style="appearance: none; width: 18px; height: 18px; border: 2px solid var(--primary-gold); 
                          border-radius: 3px; margin-right: 8px; position: relative; flex-shrink: 0; margin-top: 3px;">
            <label for="commitment-social-media" style="cursor: pointer; margin: 0;">A respetar las más elementales
                reglas del trato social y de respeto a las personas e instituciones cuando utilicen WhatsApp, redes
                sociales o lleven a cabo comunicaciones públicas.</label>
        </div>

        <div class="checkbox-group" style="display: flex; align-items: flex-start; margin-bottom: 15px;">
            <input type="checkbox" id="commitment-coach" name="commitment-coach" required style="appearance: none; width: 18px; height: 18px; border: 2px solid var(--primary-gold); 
                          border-radius: 3px; margin-right: 8px; position: relative; flex-shrink: 0; margin-top: 3px;">
            <label for="commitment-coach" style="cursor: pointer; margin: 0;">A acatar cualquier orden del entrenador
                cuando éste se halle en funciones como tal, y permanecerá en el campo, la concentración, o la reunión,
                mientras no se diga lo contrario.</label>
        </div>

        <div class="checkbox-group" style="display: flex; align-items: flex-start; margin-bottom: 15px;">
            <input type="checkbox" id="commitment-punctuality" name="commitment-punctuality" required style="appearance: none; width: 18px; height: 18px; border: 2px solid var(--primary-gold); 
                          border-radius: 3px; margin-right: 8px; position: relative; flex-shrink: 0; margin-top: 3px;">
            <label for="commitment-punctuality" style="cursor: pointer; margin: 0;">A asistir puntualmente a todas las
                sesiones de fuerza y a los entrenamientos programados, salvo los que el entrenador designe como
                "voluntarios". Solamente el entrenador, según su criterio, puede dar permiso para faltar o llegar con
                retraso a ellos.</label>
        </div>

        <div class="checkbox-group" style="display: flex; align-items: flex-start; margin-bottom: 15px;">
            <input type="checkbox" id="commitment-communication" name="commitment-communication" required style="appearance: none; width: 18px; height: 18px; border: 2px solid var(--primary-gold); 
                          border-radius: 3px; margin-right: 8px; position: relative; flex-shrink: 0; margin-top: 3px;">
            <label for="commitment-communication" style="cursor: pointer; margin: 0;">A informar con antelación al
                entrenador si no puede asistir a un entrenamiento o a un partido a causa de una enfermedad o algún
                imprevisto.</label>
        </div>
    </div>

    <div class="form-group">
        <label for="player-signature">Firma de la Jugadora*</label>
        <input type="text" id="player-signature" name="player-signature"
            placeholder="Escriba su nombre completo como firma" required>
        <div class="error-message" id="player-signature_error"></div>
    </div>

    <div class="form-group">
        <label for="parent-signature">Firma Padre/Madre/Tutor*</label>
        <input type="text" id="parent-signature" name="parent-signature"
            placeholder="Escriba su nombre completo como firma" required>
        <div class="error-message" id="parent-signature_error"></div>
    </div>

    <div class="navigation-buttons">
        <button type="button" class="secondary" onclick="navigateToStep(4)">Anterior</button>
        <button type="button" id="step5Button" onclick="saveStep(5)">Guardar y continuar</button>
    </div>

    <div style="text-align: center; margin-top: 20px;">
        <button type="button" id="confirmationButton" onclick="goToConfirmation()"
            style="display: none; background: var(--secondary-gold);">
            Ir a Confirmación
        </button>
    </div>
</div>

<!-- Paso 6: Confirmación -->
<div class="form-container" id="step6Form">
    <h2>Confirmación de Inscripción</h2>

    <div class="summary-container" id="resumenInscripcion">
        <!-- Aquí se mostrará el resumen simplificado -->
    </div>
</div>

<!-- Paso 7: Pago (versión simplificada) -->
<div class="form-container" id="step7Form">
    <h2>Pago de Inscripción</h2>

    <div class="payment-info">
        <h3>Resumen de tu inscripción</h3>
        <p><strong>Jugadora:</strong> <span id="payment-name"></span></p>
        <p><strong>Categoría:</strong> <span id="payment-category"></span></p>
        <p><strong>Importe:</strong> 130,00€ (pago único)</p>

        <div class="payment-ready">
            <p>✅ Tu información está completa y lista para el pago.</p>
        </div>
    </div>

    <div class="navigation-buttons">
        <button type="button" class="secondary" onclick="navigateToStep(6)">Anterior</button>
        <button type="button" class="primary-button" onclick="openPaymentModal()">
            Realizar Pago
        </button>
    </div>
</div>

<!-- Modal para el pago -->
<div id="payment-modal" class="modal" style="display: none;">
    <div class="modal-content">
        <span class="close-modal">&times;</span>

        <div class="modal-header">
            <h2>Pago de Inscripción</h2>
        </div>
        <div class="stripe-payment-container">
            <div id="stripe-payment-message" class="stripe-hidden"></div>

            <form id="payment-form">
                <div class="form-group">
                    <label>Datos de pago</label>
                    <div id="payment-element" class="stripe-element-container">
                        <!-- Stripe.js creará los elementos aquí -->
                    </div>
                </div>

                <div class="stripe-actions">
                    <button type="button" class="secondary-btn" onclick="closePaymentModal()">
                        Cancelar
                    </button>
                    <button type="submit" id="submit-payment" class="primary-btn">
                        <div class="spinner hidden" id="spinner"></div>
                        <span id="button-text">Pagar ahora 130€</span>
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- Pantalla de confirmación -->
<div class="confirmation-screen" id="confirmationScreen">
    <h2>¡Inscripción Completada con Éxito!</h2>
    <p>Tu inscripción al Club Olympia ha sido procesada correctamente.</p>
    <p>Se ha enviado un email de confirmación a: <strong id="confirmation-email"></strong></p>
    <p>Número de referencia: <strong id="reference-number"></strong></p>
    <div class="alert alert-info">
        <p>Guarda este número de referencia para cualquier consulta futura.</p>
    </div>
    <button onclick="window.location.reload()">Volver al Inicio</button>
</div>

<script>
    // State management
    let confirmationReached = false;
    let currentStep = 1;
    const completedSteps = new Set();
    const formData = {
        step1: {},
        step2: {},
        step3: {},
        step4: {},
        step5: {},
        step6: {},
        step7: {}
    };

    function startRegistration() {
            document.getElementById('welcomeScreen').style.display = 'none';
            showStepForm(1); // Mostrar directamente el paso 1
            currentStep = 1; // Establecer el paso actual como 1
        }
        function backToStart() {
            if (confirm('¿Estás seguro de que quieres volver al inicio? Los datos no guardados se perderán.')) {
                window.location.reload();
            }
        }

    // Also fix the hideAllForms function to handle null elements
        // Y la función hideAllForms:
           function hideAllForms() {
                // Hide all forms
                document.querySelectorAll('.form-container').forEach(form => {
                    if (form) {
                        form.style.display = 'none';
                    }
                });

                // Hide payment modal
                document.getElementById('payment-modal').style.display = 'none';

                // Hide confirmation screen if visible
                const confirmationScreen = document.getElementById('confirmationScreen');
                if (confirmationScreen) {
                    confirmationScreen.style.display = 'none';
                }
            }
    // Fix the showStepForm function
        // Función simplificada para mostrar formularios:
            function showStepForm(stepNumber) {
                // Hide all forms
                hideAllForms();

                // Show the selected form
                const stepForm = document.getElementById(`step${stepNumber}Form`);
                if (stepForm) {
                    stepForm.style.display = 'block';
                }
            }

    // Modifica la función navigateToStep para que funcione sin el menú:
        function navigateToStep(stepNumber) {
            // Save current step data
            // Si estamos viniendo desde confirmación, guardar el paso actual primero
            if (currentStep === 6 && stepNumber !== 6) {
                // Cuando vamos a editar desde confirmación, no validamos
                // porque el usuario solo quiere modificar algo específico
                saveStepData(currentStep);
            } else if (currentStep !== stepNumber && !validateStep(currentStep)) {
                // Validación normal para otros casos
                return;
            } else {
                saveStepData(currentStep);
            }

            currentStep = stepNumber;

            // Show the form for the current step
            showStepForm(stepNumber);

            if (stepNumber === 3) {
                populatePlayerData();
            }


            // Marcar que hemos llegado a confirmación cuando estemos en el paso 6
            if (stepNumber === 6) {
                confirmationReached = true;
                updateConfirmationSummary();
            }


            if (stepNumber === 4) {
                populateDataProtectionData();
            }

            if (stepNumber === 5) {
                populateCommitmentData();
            }

           

            // Special handling for payment step
            if (stepNumber === 7) {
                updatePaymentInfo();
                openPaymentModal(); // Abrir modal en lugar de inicializar directamen
            }

             // Show the form for the current step
            updateConfirmationButton(); // Actualizar visibilidad del botón


        }

    // Función para mostrar/ocultar el botón de confirmación
        function updateConfirmationButton() {
            const confirmationBtn = document.getElementById('confirmationButton');
            if (confirmationBtn) {
                confirmationBtn.style.display = confirmationReached ? 'block' : 'none';
            }
        }

    // Función para ir directamente a la pantalla de confirmación
        function goToConfirmation() {
            if (validateStep(currentStep)) {
                saveStepData(currentStep);
                navigateToStep(6);
            }
        }

    // Función para volver a confirmación después de editar
        function backToConfirmation() {
            if (validateStep(currentStep)) {
                saveStepData(currentStep);
                navigateToStep(6);
            }
        }


    function updateStepAccess() {
        document.querySelectorAll('.step-card').forEach((card, index) => {
            const stepNumber = index + 1;
            if (stepNumber <= currentStep || completedSteps.has(stepNumber)) {
                card.classList.remove('locked');
            } else {
                card.classList.add('locked');
            }
        });
    }

    function validateStep(step) {
        switch (step) {
            case 1:
                return validateStep1();
            case 2:
                return validateStep2();
            case 3:
                return validateStep3();
            case 4:
                return validateStep4();
            case 5:
                return validateStep5();
            case 6:
                return true; // Confirmation step doesn't need validation
            case 7:
                return validateStep7();
            default:
                return true;
        }
    }

    // Add this script to handle the conditional field
        document.addEventListener('DOMContentLoaded', function () {
            const playedBeforeYes = document.getElementById('played-before-yes');
            const playedBeforeNo = document.getElementById('played-before-no');
            const previousTeamsContainer = document.getElementById('previous-teams-container');

            if (playedBeforeYes && playedBeforeNo && previousTeamsContainer) {
                playedBeforeYes.addEventListener('change', function () {
                    previousTeamsContainer.style.display = this.checked ? 'block' : 'none';
                });

                playedBeforeNo.addEventListener('change', function () {
                    previousTeamsContainer.style.display = this.checked ? 'none' : 'block';
                });
            }
        });



    // Specifically for Step 1 validation only
        function validateStep1() {
            const required = [
                'full-name', 'birthdate', 'category', 'birth-municipality',
                'empadronamiento', 'landline', 'address', 'city', 'zip-code',
                'mother-name', 'mother-dni', 'mother-email', 'mother-phone', 'mother-birthplace',
                'club-rules', 'privacy-policy', 'health-data'
            ];
            let isValid = true;

            required.forEach(field => {
                if (field === 'club-rules' || field === 'privacy-policy' || field === 'health-data') {
                    const element = document.getElementById(field);
                    const errorElement = document.getElementById(`${field}_error`);
                    if (element && !element.checked) {
                        element.style.outline = '2px solid red';
                        if (errorElement) errorElement.textContent = 'Debes aceptar este campo';
                        isValid = false;
                    } else if (element) {
                        element.style.outline = '';
                        if (errorElement) errorElement.textContent = '';
                    }
                } else {
                    const element = document.getElementById(field);
                    const errorElement = document.getElementById(`${field}_error`);
                    if (element && !element.value.trim()) {
                        element.style.borderColor = 'red';
                        if (errorElement) errorElement.textContent = 'Este campo es obligatorio';
                        isValid = false;
                    } else if (element) {
                        element.style.borderColor = '';
                        if (errorElement) errorElement.textContent = '';
                    }
                }
            });

            // Email validation (if provided)
            const email = document.getElementById('email');
            const motherEmail = document.getElementById('mother-email');
            const emailError = document.getElementById('email_error');
            const motherEmailError = document.getElementById('mother-email_error');

            if (email && email.value && !/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email.value)) {
                email.style.borderColor = 'red';
                if (emailError) emailError.textContent = 'Por favor, introduce un email válido';
                isValid = false;
            }

            if (motherEmail && motherEmail.value && !/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(motherEmail.value)) {
                motherEmail.style.borderColor = 'red';
                if (motherEmailError) motherEmailError.textContent = 'Por favor, introduce un email válido';
                isValid = false;
            }

            return isValid;
        }

    function validateStep2() {
            const required = [
                'signature-date', 'account-holder', 'account-holder-dni',
                'account-holder-address', 'account-holder-zip', 'account-holder-city',
                'account-holder-province', 'iban', 'payment-type'
            ];
            let isValid = true;

            required.forEach(field => {
                if (field === 'payment-type') {
                    const recurrentRadio = document.getElementById('payment-type-recurrent');
                    const singleRadio = document.getElementById('payment-type-single');
                    const errorElement = document.getElementById(`${field}_error`);

                    if (!recurrentRadio.checked && !singleRadio.checked) {
                        errorElement.textContent = 'Debes seleccionar un tipo de pago';
                        isValid = false;
                    } else {
                        errorElement.textContent = '';
                    }
                } else {
                    const element = document.getElementById(field);
                    const errorElement = document.getElementById(`${field}_error`);
                    if (!element.value.trim()) {
                        element.style.borderColor = 'red';
                        errorElement.textContent = 'Este campo es obligatorio';
                        isValid = false;
                    } else {
                        element.style.borderColor = '';
                        errorElement.textContent = '';
                    }
                }
            });

            // Validación básica de IBAN (formato español)
            const iban = document.getElementById('iban');
            const ibanError = document.getElementById('iban_error');
            if (iban.value && !/^ES\d{22}$/.test(iban.value.replace(/\s/g, ''))) {
                iban.style.borderColor = 'red';
                ibanError.textContent = 'Formato de IBAN español incorrecto (ES seguido de 22 dígitos)';
                isValid = false;
            }

            return isValid;
        }

    // Validación para el paso 3
        function validateStep3() {
            const required = [
                'authorization-date', 'mother-signature-name',
                'mother-signature-dni', 'mother-signature'
            ];
            let isValid = true;

            required.forEach(field => {
                const element = document.getElementById(field);
                const errorElement = document.getElementById(`${field}_error`);
                if (!element.value.trim()) {
                    element.style.borderColor = 'red';
                    errorElement.textContent = 'Este campo es obligatorio';
                    isValid = false;
                } else {
                    element.style.borderColor = '';
                    errorElement.textContent = '';
                }
            });

            return isValid;
        }

    // Validación para el paso 4
        function validateStep4() {
            const required = [
                'data-protection-signature-name',
                'data-protection-signature-dni',
                'data-protection-signature',
                'data-protection-consent'
            ];
            let isValid = true;

            required.forEach(field => {
                if (field === 'data-protection-consent') {
                    const element = document.getElementById(field);
                    const errorElement = document.getElementById(`${field}_error`);
                    if (!element.checked) {
                        element.style.outline = '2px solid red';
                        errorElement.textContent = 'Debe aceptar el consentimiento de protección de datos';
                        isValid = false;
                    } else {
                        element.style.outline = '';
                        errorElement.textContent = '';
                    }
                } else {
                    const element = document.getElementById(field);
                    const errorElement = document.getElementById(`${field}_error`);
                    if (!element.value.trim()) {
                        element.style.borderColor = 'red';
                        errorElement.textContent = 'Este campo es obligatorio';
                        isValid = false;
                    } else {
                        element.style.borderColor = '';
                        errorElement.textContent = '';
                    }
                }
            });

            return isValid;
        }

    // Validación corregida para el paso 5
        function validateStep5() {
            const requiredCheckboxes = [
                'commitment-behavior', 'commitment-sportsmanship', 'commitment-social-media',
                'commitment-coach', 'commitment-punctuality', 'commitment-communication'
            ];

            const requiredFields = [
                'commitment-date', 'player-signature', 'parent-signature'
            ];

            let isValid = true;

            // Validar checkboxes
            requiredCheckboxes.forEach(field => {
                const element = document.getElementById(field);
                if (!element.checked) {
                    element.style.outline = '2px solid red';
                    isValid = false;

                    // Crear o actualizar mensaje de error
                    let errorElement = document.getElementById(`${field}_error`);
                    if (!errorElement) {
                        errorElement = document.createElement('div');
                        errorElement.className = 'error-message';
                        errorElement.id = `${field}_error`;
                        element.parentNode.appendChild(errorElement);
                    }
                    errorElement.textContent = 'Debe aceptar este compromiso';
                } else {
                    element.style.outline = '';
                    const errorElement = document.getElementById(`${field}_error`);
                    if (errorElement) errorElement.textContent = '';
                }
            });

            // Validar campos de texto
            requiredFields.forEach(field => {
                const element = document.getElementById(field);
                const errorElement = document.getElementById(`${field}_error`);
                if (!element.value.trim()) {
                    element.style.borderColor = 'red';
                    errorElement.textContent = 'Este campo es obligatorio';
                    isValid = false;
                } else {
                    element.style.borderColor = '';
                    errorElement.textContent = '';
                }
            });

            return isValid;
        }

    function validateStep7() {
        const comprobantePago = document.getElementById('comprobante_pago');
        const comprobanteError = document.getElementById('comprobante_pago_error');
        let isValid = true;

        if (!comprobantePago.value) {
            comprobantePago.style.borderColor = 'red';
            comprobanteError.textContent = 'Debes seleccionar una opción';
            isValid = false;
        } else {
            comprobantePago.style.borderColor = '';
            comprobanteError.textContent = '';
        }

        return isValid;
    }

    function saveStepData(step) {
            switch (step) {
                case 1:
                    formData.step1 = {
                        fullName: document.getElementById('full-name').value,
                        birthdate: document.getElementById('birthdate').value,
                        category: document.getElementById('category').value,
                        birthMunicipality: document.getElementById('birth-municipality').value,
                        empadronamiento: document.getElementById('empadronamiento').value,
                        playerDni: document.getElementById('player-dni').value,
                        email: document.getElementById('email').value,
                        phone: document.getElementById('phone').value,
                        landline: document.getElementById('landline').value,
                        address: document.getElementById('address').value,
                        city: document.getElementById('city').value,
                        zipCode: document.getElementById('zip-code').value,
                        playedBefore: document.querySelector('input[name="played-before"]:checked')?.value,
                        previousTeams: document.getElementById('previous-teams').value,
                        motherName: document.getElementById('mother-name').value,
                        motherDni: document.getElementById('mother-dni').value,
                        motherEmail: document.getElementById('mother-email').value,
                        motherPhone: document.getElementById('mother-phone').value,
                        motherBirthplace: document.getElementById('mother-birthplace').value,
                        fatherName: document.getElementById('father-name').value,
                        fatherDni: document.getElementById('father-dni').value,
                        fatherEmail: document.getElementById('father-email').value,
                        fatherPhone: document.getElementById('father-phone').value,
                        fatherBirthplace: document.getElementById('father-birthplace').value,
                        clubRules: document.getElementById('club-rules').checked,
                        privacyPolicy: document.getElementById('privacy-policy').checked,
                        healthData: document.getElementById('health-data').checked,
                        socialMediaImage: document.getElementById('social-media-image').checked,
                        internetImage: document.getElementById('internet-image').checked,
                        marketing: document.getElementById('marketing').checked
                    };
                    break;
            case 2:
                formData.step2 = {
                        signatureDate: document.getElementById('signature-date').value,
                        accountHolder: document.getElementById('account-holder').value,
                        accountHolderDni: document.getElementById('account-holder-dni').value,
                        accountHolderAddress: document.getElementById('account-holder-address').value,
                        accountHolderZip: document.getElementById('account-holder-zip').value,
                        accountHolderCity: document.getElementById('account-holder-city').value,
                        accountHolderProvince: document.getElementById('account-holder-province').value,
                        swiftCode: document.getElementById('swift-code').value,
                        iban: document.getElementById('iban').value,
                        paymentType: document.querySelector('input[name="payment-type"]:checked')?.value
                };
                break;
            case 3:
                formData.step3 = {
                        authorizationDate: document.getElementById('authorization-date').value,
                        motherSignatureName: document.getElementById('mother-signature-name').value,
                        motherSignatureDni: document.getElementById('mother-signature-dni').value,
                        motherSignature: document.getElementById('mother-signature').value,
                        fatherSignatureName: document.getElementById('father-signature-name').value,
                        fatherSignatureDni: document.getElementById('father-signature-dni').value,
                        fatherSignature: document.getElementById('father-signature').value,
                        singleParentReason: document.getElementById('single-parent-reason').value,
                        otherReason: document.getElementById('other-reason').value
                    };
                break;
            case 4:
                    formData.step4 = {
                        dataProtectionSignatureName: document.getElementById('data-protection-signature-name').value,
                        dataProtectionSignatureDni: document.getElementById('data-protection-signature-dni').value,
                        dataProtectionSignature: document.getElementById('data-protection-signature').value,
                        dataProtectionConsent: document.getElementById('data-protection-consent').checked
                    };
                break;
            case 5:
                formData.step5 = {
                        commitmentDate: document.getElementById('commitment-date').value,
                        commitmentBehavior: document.getElementById('commitment-behavior').checked,
                        commitmentSportsmanship: document.getElementById('commitment-sportsmanship').checked,
                        commitmentSocialMedia: document.getElementById('commitment-social-media').checked,
                        commitmentCoach: document.getElementById('commitment-coach').checked,
                        commitmentPunctuality: document.getElementById('commitment-punctuality').checked,
                        commitmentCommunication: document.getElementById('commitment-communication').checked,
                        playerSignature: document.getElementById('player-signature').value,
                        parentSignature: document.getElementById('parent-signature').value
                    };
                break;
            case 7:
                formData.step7 = {
                    comprobantePago: document.getElementById('comprobante_pago').value
                };
                break;
        }
    }

    // Rellenar automáticamente con datos del tutor si están disponibles
        function populateDataProtectionData() {
            if (formData.step1 && formData.step3) {
                // Usar datos de la madre/tutora por defecto
                document.getElementById('data-protection-signature-name').value =
                    formData.step3.motherSignatureName || formData.step1.motherName || '';

                document.getElementById('data-protection-signature-dni').value =
                    formData.step3.motherSignatureDni || formData.step1.motherDni || '';
            }
        }

    
        // Rellenar automáticamente con datos del jugador
            function populateCommitmentData() {
                if (formData.step1) {
                    document.getElementById('commitment-player-name').textContent = formData.step1.fullName || '';
                    document.getElementById('commitment-player-dni').textContent = formData.step1.playerDni || 'No proporcionado';

                    // Autorellenar firma de la jugadora
                    document.getElementById('player-signature').value = formData.step1.fullName || '';

                    // Autorellenar firma del tutor (usar madre por defecto)
                    if (formData.step3) {
                        document.getElementById('parent-signature').value = formData.step3.motherSignatureName || '';
                    }
                }
            }


    function populatePlayerData() {
            if (formData.step1) {
                document.getElementById('player-name-display').textContent = formData.step1.fullName || '';
                document.getElementById('player-dni-display').textContent = formData.step1.playerDni || 'No proporcionado';
                document.getElementById('player-address-display').textContent =
                    `${formData.step1.address || ''}, ${formData.step1.city || ''} ${formData.step1.zipCode || ''}`;
            }
        }

        // Mostrar/ocultar campo de otras circunstancias
        document.addEventListener('DOMContentLoaded', function () {
            const reasonSelect = document.getElementById('single-parent-reason');
            const otherReasonContainer = document.getElementById('other-reason-container');

            if (reasonSelect && otherReasonContainer) {
                reasonSelect.addEventListener('change', function () {
                    otherReasonContainer.style.display = this.value === 'otras' ? 'block' : 'none';
                });
            }
        });


    function updateConfirmationSummary() {
            const summaryContainer = document.getElementById('resumenInscripcion');
             summaryContainer.innerHTML = `
        <h3>Revisa y confirma tu inscripción</h3>
        <p>Por favor, revisa que toda la información sea correcta antes de proceder al pago.</p>
        
        <div class="confirmation-steps">
            <div class="confirmation-step-item">
                <div class="confirmation-step-info">
                    <h4>Paso 1: Información Personal</h4>
                    <p>Datos personales de la jugadora y tutores</p>
                </div>
                <button type="button" class="edit-btn" onclick="navigateToStep(1)">✏️ Editar</button>
            </div>

            <div class="confirmation-step-item">
                <div class="confirmation-step-info">
                    <h4>Paso 2: Domiciliación Bancaria</h4>
                    <p>Datos de cuenta bancaria para domiciliación</p>
                </div>
                <button type="button" class="edit-btn" onclick="navigateToStep(2)">✏️ Editar</button>
            </div>

            <div class="confirmation-step-item">
                <div class="confirmation-step-info">
                    <h4>Paso 3: Autorización para Menores</h4>
                    <p>Autorización y consentimiento de tutores</p>
                </div>
                <button type="button" class="edit-btn" onclick="navigateToStep(3)">✏️ Editar</button>
            </div>

            <div class="confirmation-step-item">
                <div class="confirmation-step-info">
                    <h4>Paso 4: Protección de Datos</h4>
                    <p>Consentimiento para tratamiento de datos</p>
                </div>
                <button type="button" class="edit-btn" onclick="navigateToStep(4)">✏️ Editar</button>
            </div>

            <div class="confirmation-step-item">
                <div class="confirmation-step-info">
                    <h4>Paso 5: Carta de Compromiso</h4>
                    <p>Compromisos de la jugadora y tutores</p>
                </div>
                <button type="button" class="edit-btn" onclick="navigateToStep(5)">✏️ Editar</button>
            </div>
        </div>

        <div class="confirmation-total">
            <h4>Total a pagar: 130,00€</h4>
            <p class="confirmation-note">Una vez confirmado, serás redirigido a la pasarela de pago</p>
        </div>

        <div class="navigation-buttons">
            <button type="button" class="secondary" onclick="navigateToStep(5)">Anterior</button>
            <button type="button" id="step6Button" onclick="saveStep(6)">Confirmar y Proceder al Pago</button>
        </div>
    `;
        // DEBUG: Check email functionality
        debugEmailFunctionality();
    }

    function updatePaymentInfo() {
            document.getElementById('payment-name').textContent = formData.step1.fullName || '';
            document.getElementById('payment-category').textContent = formData.step1.category || '';
            document.getElementById('modal-payment-name').textContent = formData.step1.fullName || '';
            document.getElementById('modal-payment-category').textContent = formData.step1.category || '';
        }

    function formatDate(dateString) {
        if (!dateString) return '';
        const date = new Date(dateString);
        return date.toLocaleDateString('es-ES');
    }

    // Update the validation for Step 1
        function validateStep1() {
            const required = [
                'full-name', 'birthdate', 'category', 'birth-municipality',
                'empadronamiento', 'landline', 'address', 'city', 'zip-code',
                'mother-name', 'mother-dni', 'mother-email', 'mother-phone', 'mother-birthplace',
                'club-rules', 'privacy-policy', 'health-data'
            ];
            let isValid = true;

            required.forEach(field => {
                if (field === 'played-before') {
                    const yesRadio = document.getElementById('played-before-yes');
                    const noRadio = document.getElementById('played-before-no');
                    const errorElement = document.getElementById(`${field}_error`);

                    if (!yesRadio.checked && !noRadio.checked) {
                        errorElement.textContent = 'Debes seleccionar una opción';
                        isValid = false;
                    } else {
                        errorElement.textContent = '';
                    }
                } else if (field === 'club-rules' || field === 'privacy-policy' || field === 'health-data') {
                    const element = document.getElementById(field);
                    const errorElement = document.getElementById(`${field}_error`);
                    if (!element.checked) {
                        element.style.outline = '2px solid red';
                        errorElement.textContent = 'Debes aceptar este campo';
                        isValid = false;
                    } else {
                        element.style.outline = '';
                        errorElement.textContent = '';
                    }
                } else {
                    const element = document.getElementById(field);
                    const errorElement = document.getElementById(`${field}_error`);
                    if (!element.value.trim()) {
                        element.style.borderColor = 'red';
                        errorElement.textContent = 'Este campo es obligatorio';
                        isValid = false;
                    } else {
                        element.style.borderColor = '';
                        errorElement.textContent = '';
                    }
                }
            });

            // Email validation (if provided)
            const email = document.getElementById('email');
            const motherEmail = document.getElementById('mother-email');
            const emailError = document.getElementById('email_error');
            const motherEmailError = document.getElementById('mother-email_error');

            if (email.value && !/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email.value)) {
                email.style.borderColor = 'red';
                emailError.textContent = 'Por favor, introduce un email válido';
                isValid = false;
            }

            if (motherEmail.value && !/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(motherEmail.value)) {
                motherEmail.style.borderColor = 'red';
                motherEmailError.textContent = 'Por favor, introduce un email válido';
                isValid = false;
            }

            return isValid;
        }


        
    // Add this function to help debug email issues
        function debugEmailFunctionality() {
            console.group("EMAIL DEBUG INFO");
            console.log("Form Data:", formData);
            console.log("Email Address:", formData.step1.email);
            console.log("Current Domain:", window.location.hostname);
            console.groupEnd();
        }


    function showConfirmationScreen(referenceNumber) {
        // Hide all other screens
        hideAllForms();

        // Show confirmation screen
        document.getElementById('confirmation-email').textContent = formData.step1.email;
        document.getElementById('reference-number').textContent = referenceNumber;
        document.getElementById('confirmationScreen').style.display = 'block';
    }

    function showMessage(message, type) {
        const messageElement = document.getElementById('payment-message');
        messageElement.textContent = message;
        messageElement.className = `payment-message ${type}`;
    }

    function getCookie(name) {
        let cookieValue = null;
        if (document.cookie && document.cookie !== '') {
            const cookies = document.cookie.split(';');
            for (let i = 0; i < cookies.length; i++) {
                const cookie = cookies[i].trim();
                if (cookie.substring(0, name.length + 1) === (name + '=')) {
                    cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                    break;
                }
            }
        }
        return cookieValue;
    }

    // Initialize step buttons
    document.addEventListener('DOMContentLoaded', function () {
        for (let i = 1; i <= 7; i++) {
            const button = document.getElementById(`step${i}Button`);
            if (button) {
                button.addEventListener('click', function () {
                    saveStep(i);
                });
            }
        }
    });

    function saveStep(step) {
            if (step === 6) {
                // Para el paso de confirmación, proceder directamente al pago
                navigateToStep(7);
            } else if (validateStep(step)) {
                saveStepData(step);

                // Si estamos en el último paso antes de confirmación, mostrar el botón
                if (step === 5) {
                    confirmationReached = true;
                }

                navigateToStep(step + 1);
            }
        }

        // Also update the event listeners to use the correct function
        document.addEventListener('DOMContentLoaded', function () {
            for (let i = 1; i <= 7; i++) {
                const button = document.getElementById(`step${i}Button`);
                if (button) {
                    button.addEventListener('click', function () {
                        if (validateStep(i)) {
                            navigateToStep(i + 1);
                        }
                    });
                }
            }
        });



        // Configuración de Stripe - Reemplaza con tus claves
            const stripe = Stripe('pk_test_51S3aPM2W7WhI0yvpQSVeGOHZEm8NfImrt2ZVXR34EkzevVoW6DDSVL6xpcY4FhuNWqzXbDN616c1MEWrrNyiQiiC00xOrROFOh'); // Clave pública de test

            // Configuración de elementos de pago
            let elements;

            function initializeStripe() {
                console.log('Solicitando PaymentIntent...');
                fetch('/create-payment-intent/', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'X-CSRFToken': getCookie('csrftoken'),
                    }
                })
                    .then(response => {
                        // Aquí solo tenemos response, NO data
                        console.log('Status de respuesta:', response.status);

                        if (!response.ok) {
                            throw new Error(`HTTP error! status: ${response.status}`);
                        }
                        return response.json();
                    })
                    .then(data => {
                        // Aquí SÍ tenemos data
                        console.log('Respuesta del servidor:', data); // ← MOVIDO AQUÍ

                        if (!data.clientSecret) {
                            throw new Error('No clientSecret received from server');
                        }

                        console.log('PaymentIntent ID:', data.paymentIntentId);
                        console.log('Client secret received');

                        elements = stripe.elements({
                            clientSecret: data.clientSecret,
                            appearance: { theme: 'stripe' }
                        });

                        const paymentElement = elements.create('payment');
                        paymentElement.mount('#payment-element');

                    })
                    .catch(error => {
                        console.error('Error initializing Stripe:', error);
                        showStripeMessage('Error al configurar el pago: ' + error.message, 'error');
                    });
}

            // Manejar envío del formulario de pago
            document.getElementById('payment-form').addEventListener('submit', handleSubmit);

            // Función handleSubmit actualizada
                async function handleSubmit(e) {
                    e.preventDefault();

                    setLoading(true);

                    try {
                        const { error, paymentIntent } = await stripe.confirmPayment({
                            elements,
                            confirmParams: {
                                return_url: `${window.location.origin}/payment-success/`,
                            },
                            redirect: 'if_required'
                        });

                        if (error) {
                            console.error('Stripe error:', error);
                            showStripeMessage(error.message, 'error');
                        } else if (paymentIntent && paymentIntent.status === 'succeeded') {
                            // Pago exitoso
                            completeRegistration();
                        } else {
                            showStripeMessage('Estado de pago desconocido', 'error');
                        }
                    } catch (error) {
                        console.error('Unexpected error:', error);
                        showStripeMessage('Error inesperado: ' + error.message, 'error');
                    }

                    setLoading(false);
                }

            function showStripeMessage(message, type = '') {
                const messageContainer = document.getElementById('stripe-payment-message');

                messageContainer.textContent = message;
                messageContainer.classList.remove('hidden', 'error');

                if (type === 'error') {
                    messageContainer.classList.add('error');
                }

                setTimeout(() => {
                    messageContainer.classList.add('hidden');
                }, 5000);
            }

            function setLoading(isLoading) {
                const submitButton = document.getElementById('submit-payment');
                const spinner = document.getElementById('spinner');
                const buttonText = document.getElementById('button-text');

                if (isLoading) {
                    submitButton.disabled = true;
                    spinner.classList.remove('hidden');
                    buttonText.textContent = 'Procesando...';
                } else {
                    submitButton.disabled = false;
                    spinner.classList.add('hidden');
                    buttonText.textContent = 'Pagar ahora';
                }
            }

            // Modificar la función completeRegistration para que solo se ejecute tras pago exitoso
            function completeRegistration() {
                // Preparar datos para envío (igual que antes)
                 const submissionData = {
                    // Player information
                    full_name: formData.step1.fullName,
                    birthdate: formData.step1.birthdate,
                    category: formData.step1.category,
                    birth_municipality: formData.step1.birthMunicipality,
                    empadronamiento: formData.step1.empadronamiento,
                    player_dni: formData.step1.playerDni,
                    email: formData.step1.email,
                    phone: formData.step1.phone,
                    landline: formData.step1.landline,
                    address: formData.step1.address,
                    city: formData.step1.city,
                    zip_code: formData.step1.zipCode,
                    played_before: formData.step1.playedBefore,
                    previous_teams: formData.step1.previousTeams,

                    // Mother/Tutor information
                    mother_name: formData.step1.motherName,
                    mother_dni: formData.step1.motherDni,
                    mother_email: formData.step1.motherEmail,
                    mother_phone: formData.step1.motherPhone,
                    mother_birthplace: formData.step1.motherBirthplace,

                    // Father information (optional)
                    father_name: formData.step1.fatherName,
                    father_dni: formData.step1.fatherDni,
                    father_email: formData.step1.fatherEmail,
                    father_phone: formData.step1.fatherPhone,
                    father_birthplace: formData.step1.fatherBirthplace,

                    // Consents
                    club_rules: formData.step1.clubRules,
                    privacy_policy: formData.step1.privacyPolicy,
                    health_data: formData.step1.healthData,
                    social_media_image: formData.step1.socialMediaImage,
                    internet_image: formData.step1.internetImage,
                    marketing: formData.step1.marketing,

                    // Bank information
                    signature_date: formData.step2.signatureDate,
                    account_holder: formData.step2.accountHolder,
                    account_holder_dni: formData.step2.accountHolderDni,
                    account_holder_address: formData.step2.accountHolderAddress,
                    account_holder_zip: formData.step2.accountHolderZip,
                    account_holder_city: formData.step2.accountHolderCity,
                    account_holder_province: formData.step2.accountHolderProvince,
                    swift_code: formData.step2.swiftCode,
                    iban: formData.step2.iban,
                    payment_type: formData.step2.paymentType,

                    // Authorization data
                    authorization_date: formData.step3.authorizationDate,
                    mother_signature_name: formData.step3.motherSignatureName,
                    mother_signature_dni: formData.step3.motherSignatureDni,
                    mother_signature: formData.step3.motherSignature,
                    father_signature_name: formData.step3.fatherSignatureName,
                    father_signature_dni: formData.step3.fatherSignatureDni,
                    father_signature: formData.step3.fatherSignature,
                    single_parent_reason: formData.step3.singleParentReason,
                    other_reason: formData.step3.otherReason,

                    // Data protection
                    data_protection_signature_name: formData.step4.dataProtectionSignatureName,
                    data_protection_signature_dni: formData.step4.dataProtectionSignatureDni,
                    data_protection_signature: formData.step4.dataProtectionSignature,
                    data_protection_consent: formData.step4.dataProtectionConsent,

                    // Commitment letter
                    commitment_date: formData.step5.commitmentDate,
                    commitment_behavior: formData.step5.commitmentBehavior,
                    commitment_sportsmanship: formData.step5.commitmentSportsmanship,
                    commitment_social_media: formData.step5.commitmentSocialMedia,
                    commitment_coach: formData.step5.commitmentCoach,
                    commitment_punctuality: formData.step5.commitmentPunctuality,
                    commitment_communication: formData.step5.commitmentCommunication,
                    player_signature: formData.step5.playerSignature,
                    parent_signature: formData.step5.parentSignature,

                    // Payment information
                    comprobante_pago: formData.step7.comprobantePago,

                    // Additional fields
                    season: "2023/2024",
                    registration_fee: "150"
                };

                   // Enviar datos al backend
                fetch('/create-inscription/', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'X-CSRFToken': getCookie('csrftoken'),
                    },
                    body: JSON.stringify(submissionData)
                })
                    .then(response => response.json())
                    .then(data => {
                        if (data.status === 'success') {
                            // Cerrar modal de pago
                            closePaymentModal();

                            // Ocultar todos los formularios
                            hideAllForms();

                            // Mostrar pantalla de confirmación
                            document.getElementById('confirmation-email').textContent = formData.step1.email || formData.step1.motherEmail;
                            document.getElementById('reference-number').textContent = data.inscription_number;
                            document.getElementById('confirmationScreen').style.display = 'block';
                        } else {
                            throw new Error(data.message || 'Error al procesar la inscripción');
                        }
                    })
                    .catch(error => {
                        console.error('Error:', error);
                        showStripeMessage('Error al procesar la inscripción: ' + error.message, 'error');
                    });
            }

            // Funciones para manejar el modal
                function openPaymentModal() {
                        const modal = document.getElementById('payment-modal');
                        modal.style.display = 'flex';
                        document.body.style.overflow = 'hidden';

                        // Inicializar Stripe después de que el modal esté visible
                        setTimeout(() => {
                            initializeStripe();
                        }, 100);
                    }
                
                    // Función para forzar estilos visibles
                        function forceVisibleStripeStyles() {
                            setTimeout(() => {
                                // Seleccionar todos los elementos de Stripe
                                const stripeElements = document.querySelectorAll('[class*="Stripe"], [class*="stripe"], #payment-element *');

                                stripeElements.forEach(element => {
                                    element.style.backgroundColor = '#ffffff';
                                    element.style.color = '#000000';
                                    element.style.fontSize = '16px';

                                    // Para inputs específicos
                                    if (element.tagName === 'INPUT' || element.tagName === 'SELECT') {
                                        element.style.padding = '12px';
                                        element.style.border = '1px solid #cccccc';
                                        element.style.borderRadius = '4px';
                                    }
                                });

                                // Forzar iframes de Stripe (más complicado pero intentamos)
                                const iframes = document.querySelectorAll('iframe');
                                iframes.forEach(iframe => {
                                    try {
                                        iframe.contentDocument.body.style.backgroundColor = '#ffffff';
                                        iframe.contentDocument.body.style.color = '#000000';
                                    } catch (e) {
                                        console.log('No se puede modificar iframe por políticas de seguridad');
                                    }
                                });
                            }, 2000);
                        }


                function closePaymentModal() {
                    document.getElementById('payment-modal').style.display = 'none';
                    document.body.style.overflow = 'auto'; // Permitir scroll nuevamente
                }

                // Cerrar modal al hacer clic fuera del contenido
                document.getElementById('payment-modal').addEventListener('click', function (e) {
                    if (e.target === this) {
                        closePaymentModal();
                    }
                });

                // Cerrar con la X
                    document.querySelector('.close-modal').addEventListener('click', closePaymentModal);
 


</script>

{% endblock %}